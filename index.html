<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>go.travel - Your AI-Powered Travel Companion | Smart Trip Planning</title>
    <meta name="title" content="go.travel - Your AI-Powered Travel Companion | Smart Trip Planning">
    <meta name="description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta name="keywords" content="travel planning, AI travel, trip planner, travel companion, vacation planning, travel itinerary, smart travel, travel recommendations, travel booking, go travel, go.travel, go">
    <meta name="author" content="go.travel">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://go.travel">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://go.travel">
    <meta property="og:title" content="go.travel - Your AI-Powered Travel Companion">
    <meta property="og:description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta property="og:image" content="https://go.travel/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="go.travel">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://go.travel">
    <meta property="twitter:title" content="go.travel - Your AI-Powered Travel Companion">
    <meta property="twitter:description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta property="twitter:image" content="https://go.travel/twitter-image.jpg">
    <meta name="twitter:creator" content="@gotravel">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon/web-app-manifest-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon/web-app-manifest-512x512.png">
    
    <!-- Additional SEO -->
    <meta name="theme-color" content="#1e3a8a">
    <meta name="msapplication-TileColor" content="#1e3a8a">
    <meta name="application-name" content="go.travel">
    
    <!-- Security & Performance -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Geo Location -->
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="United States">
    <meta name="ICBM" content="39.50, -98.35">
    
    <!-- Language and Locale -->
    <meta name="language" content="English">
    <meta property="og:locale" content="en_US">
    
    <!-- DNS Prefetch for performance -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Google Maps API with enhanced error handling -->
    <script>
        // Global variables for debugging
        window.mapLoadAttempts = 0;
        
        // Enhanced error handler for Google Maps
        function gm_authFailure() {
            console.error('Google Maps authentication failed');
            const mapElement = document.getElementById('map');
            if (mapElement) {
                mapElement.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f3f4f6; color: #6b7280; text-align: center; font-size: 1.1rem;"><div><div style="font-size: 2rem; margin-bottom: 1rem;">üó∫Ô∏è</div><div>Map Service Unavailable</div><div style="font-size: 0.9rem; margin-top: 0.5rem;">Please check your connection or try refreshing</div></div></div>';
            }
        }

        // Fallback if Google Maps doesn't load within 10 seconds
        setTimeout(function() {
            if (typeof google === 'undefined' || !google.maps) {
                console.warn('Google Maps failed to load within 10 seconds');
                gm_authFailure();
            }
        }, 10000);

        // Check if maps loaded successfully
        function checkMapLoad() {
            window.mapLoadAttempts++;
            console.log('Map load attempt:', window.mapLoadAttempts);
            
            if (typeof google !== 'undefined' && google.maps) {
                console.log('Google Maps API loaded successfully');
                return true;
            } else if (window.mapLoadAttempts < 5) {
                setTimeout(checkMapLoad, 2000);
            } else {
                console.error('Google Maps failed to load after multiple attempts');
                gm_authFailure();
            }
            return false;
        }

        // Start checking immediately
        setTimeout(checkMapLoad, 1000);
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQJQ5ChISn7PMXa7Qbp7ITbkufZv6Tsvc&libraries=places&callback=initMap&onerror=gm_authFailure"></script>
    
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="go.travel - Your AI-Powered Travel Companion">
    <meta itemprop="description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta itemprop="image" content="https://go.travel/og-image.jpg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-gradient: linear-gradient(135deg, #1e3a8a 0%, #059669 100%);
            --secondary-gradient: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
            --accent-blue: #1e40af;
            --accent-green: #059669;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f8fafc;
            --white: #ffffff;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        .brand-font {
            font-family: 'Dancing Script', cursive;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--primary-gradient);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            text-decoration: none;
            color: white;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        /* Hero Section */
        .hero {
            background: var(--primary-gradient);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .cta-button {
            background: white;
            color: var(--accent-blue);
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Main Content */
        .main-content {
            padding: 4rem 0;
        }

        .section {
            margin-bottom: 4rem;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Itinerary Generator */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }

        .suggestion-item:hover {
            background: #f8fafc;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .form-group {
            position: relative;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .generate-btn {
            background: var(--secondary-gradient);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 2rem;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Enhanced AI Itinerary Display */
        .ai-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .destination-overview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .overview-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .neighborhoods {
            margin-top: 1rem;
            text-align: left;
        }

        .neighborhoods ul {
            margin-left: 1rem;
            margin-top: 0.5rem;
        }

        .enhanced-day-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--accent-blue);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .day-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .day-theme {
            background: var(--secondary-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .weather-note {
            background: #e0f2fe;
            border: 1px solid #4fc3f7;
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .enhanced-activity {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-green);
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .activity-time {
            font-weight: 700;
            color: var(--accent-green);
            font-size: 1.1rem;
        }

        .activity-duration {
            background: var(--accent-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .activity-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .activity-location {
            color: var(--text-light);
            font-style: italic;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .activity-description {
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .activity-cost {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 6px;
            padding: 0.5rem;
            color: #15803d;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .insider-tip {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        .backup-option {
            background: #f3f4f6;
            border-left: 4px solid #6b7280;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        .meals-section {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .meals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .meal-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .day-extras {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e5e7eb;
        }

        .cultural-insight {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .photo-ops {
            background: #fdf4ff;
            border-left: 4px solid #d946ef;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .practical-info-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .budget-breakdown {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .budget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
        }

        .budget-category {
            font-weight: 600;
            color: var(--text-dark);
        }

        .budget-amount {
            font-weight: 700;
            color: var(--accent-green);
        }

        .total-budget {
            text-align: center;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--secondary-gradient);
            color: white;
            border-radius: 8px;
            font-size: 1.1rem;
        }

        .packing-section, .culture-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .packing-list {
            list-style: none;
            padding: 0;
        }

        .packing-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
            padding-left: 2rem;
        }

        .packing-list li:before {
            content: "üéí";
            position: absolute;
            left: 0;
        }

        .dos-donts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }

        .dos, .donts {
            padding: 1rem;
            border-radius: 8px;
        }

        .dos {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
        }

        .donts {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
        }

        .extras-section {
            background: linear-gradient(135deg, #fdf4ff 0%, #f3e8ff 100%);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .hidden-gems, .local-events {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .hidden-gems ul {
            list-style: none;
            padding: 0;
        }

        .hidden-gems li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
            padding-left: 2rem;
        }

        .hidden-gems li:before {
            content: "üíé";
            position: absolute;
            left: 0;
        }

        /* Map Container */
        .map-container {
            height: 500px;
            min-height: 400px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin: 2rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        @media (max-width: 768px) {
            .map-container {
                height: 300px;
                margin: 1rem 0;
            }
        }

        .map-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .map-control-btn {
            background: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }

        .map-control-btn:hover {
            background: #f3f4f6;
        }

        /* Safety Features */
        .safety-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .safety-card {
            background: linear-gradient(135deg, #fef7ff 0%, #f0f9ff 100%);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
        }

        .safety-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .safety-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .emergency-button {
            background: #ef4444;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
            transition: all 0.3s;
        }

        .emergency-button:hover {
            background: #dc2626;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .safety-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #e5e7eb;
            border-top: 4px solid var(--accent-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "go.travel",
        "url": "https://go.travel",
        "logo": "https://go.travel/logo.png",
        "description": "AI-powered travel companion providing personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.",
        "sameAs": [
            "https://twitter.com/gotravel",
            "https://facebook.com/gotravel",
            "https://instagram.com/gotravel"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+1-800-GO-TRAVEL",
            "contactType": "customer service",
            "availableLanguage": ["English", "Spanish", "French", "German"]
        },
        "address": {
            "@type": "PostalAddress",
            "addressCountry": "US"
        },
        "foundingDate": "2024",
        "founder": {
            "@type": "Person",
            "name": "go.travel Team"
        },
        "serviceType": "Travel Planning Service",
        "areaServed": "Worldwide"
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "go.travel",
        "url": "https://go.travel",
        "description": "Your AI-Powered Travel Companion for smart trip planning and personalized travel experiences.",
        "publisher": {
            "@type": "Organization",
            "name": "go.travel"
        },
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://go.travel/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
</head>
<body>
    <header>
        <nav class="container">
            <a href="#" class="logo brand-font" style="display: flex; align-items: center; gap: 0.5rem;">
                <img src="gotravel.png" alt="go.travel logo" style="height: 40px; width: 40px; object-fit: contain; vertical-align: middle;">
                go.travel
            </a>
            <ul class="nav-links">
                <li><a href="#itinerary">Plan Trip</a></li>
                <li><a href="#safety">Safety</a></li>
                <li><a href="#map">Map</a></li>
                <li><a href="#emergency">Emergency</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="container">
            <h1 class="brand-font">Your AI-Powered Travel Companion</h1>
            <p>Revolutionizing travel safety and ease for adventurers worldwide</p>
            <button class="cta-button" onclick="scrollToSection('itinerary')">Start Planning Your Journey</button>
        </div>
    </section>

    <main class="main-content container">
        <!-- AI-Powered Itinerary Generator -->
        <section id="itinerary" class="section">
            <h2 class="section-title brand-font">AI-Powered Itinerary Generator</h2>
            <p>Tell us about your dream trip and let our AI create the perfect personalized itinerary for you.</p>
            
            <form id="itinerary-form" class="form-grid">
                <div class="form-group">
                    <label for="destination">Destination</label>
                    <input type="text" id="destination" name="destination" placeholder="Where are you going?" autocomplete="off" required>
                    <div id="destination-suggestions" class="suggestions-dropdown"></div>
                </div>
                
                <div class="form-group">
                    <label for="start-date">Start Date</label>
                    <input type="date" id="start-date" name="start-date" required>
                </div>
                
                <div class="form-group">
                    <label for="end-date">End Date</label>
                    <input type="date" id="end-date" name="end-date" required>
                </div>
                
                <div class="form-group">
                    <label for="budget">Budget Range</label>
                    <select id="budget" name="budget" required>
                        <option value="">Select budget range</option>
                        <option value="budget">Budget ($0-$50/day)</option>
                        <option value="mid-range">Mid-range ($50-$150/day)</option>
                        <option value="luxury">Luxury ($150+/day)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="accommodation">Accommodation Preference</label>
                    <select id="accommodation" name="accommodation" required>
                        <option value="">Select accommodation type</option>
                        <option value="hostel">Hostel</option>
                        <option value="hotel">Hotel</option>
                        <option value="resort">Resort</option>
                        <option value="airbnb">Airbnb/Vacation Rental</option>
                        <option value="camping">Camping</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="transportation">Transportation Preference</label>
                    <select id="transportation" name="transportation" required>
                        <option value="">Select transportation</option>
                        <option value="walking">Walking/Public Transit</option>
                        <option value="rental-car">Rental Car</option>
                        <option value="rideshare">Rideshare/Taxi</option>
                        <option value="bicycle">Bicycle</option>
                        <option value="mixed">Mixed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="dietary">Dietary Restrictions</label>
                    <input type="text" id="dietary" name="dietary" placeholder="e.g., vegetarian, gluten-free, halal">
                </div>
                
                <div class="form-group">
                    <label for="group-size">Group Size</label>
                    <select id="group-size" name="group-size" required>
                        <option value="1">Solo traveler</option>
                        <option value="2">Couple</option>
                        <option value="3-4">Small group (3-4)</option>
                        <option value="5+">Large group (5+)</option>
                    </select>
                </div>
            </form>
            
            <div class="form-group">
                <label>Interests (Select all that apply)</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="history" name="interests" value="history">
                        <label for="history">History & Culture</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="nightlife" name="interests" value="nightlife">
                        <label for="nightlife">Nightlife</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="nature" name="interests" value="nature">
                        <label for="nature">Nature & Outdoors</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="art" name="interests" value="art">
                        <label for="art">Art & Museums</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="food" name="interests" value="food">
                        <label for="food">Food & Dining</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="shopping" name="interests" value="shopping">
                        <label for="shopping">Shopping</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="adventure" name="interests" value="adventure">
                        <label for="adventure">Adventure Sports</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="relaxation" name="interests" value="relaxation">
                        <label for="relaxation">Relaxation & Wellness</label>
                    </div>
                </div>
            </div>
            
            <button type="button" class="generate-btn" onclick="generateItinerary()">Generate My Perfect Itinerary</button>
            <button type="button" class="generate-btn" onclick="testGeminiAPI()" style="background: #28a745; margin-left: 1rem;">Test AI Connection</button>
            <button type="button" class="generate-btn" onclick="runDiagnostics()" style="background: #ffc107; color: #000; margin-left: 1rem;">Run Diagnostics</button>
            
            <div id="status-messages" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; display: none;">
                <!-- Status messages will appear here -->
            </div>
            
            <div id="help-tips" style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                <h4 style="margin: 0 0 0.5rem 0; color: #007bff;">üí° Quick Tips:</h4>
                <ul style="margin: 0; padding-left: 1.5rem;">
                    <li>Start typing in the destination field to see autocomplete suggestions</li>
                    <li>Use "Test AI Connection" to verify the AI service is working</li>
                    <li>Use "Run Diagnostics" if you experience any issues</li>
                    <li>Select your interests to get personalized recommendations</li>
                </ul>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Creating your personalized itinerary...</p>
            </div>
            
            <div class="itinerary-container" id="itinerary-results">
                <!-- Generated itinerary will appear here -->
            </div>
        </section>

        <!-- Safety Features -->
        <section id="safety" class="section">
            <h2 class="section-title brand-font">Traveler Safety Features</h2>
            <p>Your safety is our priority. Access essential safety tools and information for your destination.</p>
            
            <div class="safety-grid">
                <div class="safety-card">
                    <div class="safety-icon">üö®</div>
                    <h3>Emergency Contacts</h3>
                    <p>Quick access to local emergency numbers and services</p>
                    <button class="emergency-button" onclick="showEmergencyContacts()">View Emergency Numbers</button>
                </div>
                
                <div class="safety-card">
                    <div class="safety-icon">üìç</div>
                    <h3>Live Location Sharing</h3>
                    <p>Share your location with trusted contacts for added security</p>
                    <button class="cta-button" onclick="shareLocation()">Share Location</button>
                </div>
                
                <div class="safety-card">
                    <div class="safety-icon">üõ°Ô∏è</div>
                    <h3>Safety Tips</h3>
                    <p>Personalized safety recommendations for your destination</p>
                    <button class="cta-button" onclick="showSafetyTips()">Get Safety Tips</button>
                </div>
            </div>
        </section>

        <!-- Interactive Map -->
        <section id="map" class="section">
            <h2 class="section-title brand-font">Interactive Navigation Map</h2>
            <p>Navigate your destination with our integrated map featuring real-time location tracking.</p>
            <div class="map-container" id="map-container">
                <div class="map-controls">
                    <button class="map-control-btn" onclick="findNearbyAttractions()">üéØ Attractions</button>
                    <button class="map-control-btn" onclick="findNearbyRestaurants()">üçΩÔ∏è Restaurants</button>
                    <button class="map-control-btn" onclick="findNearbyHospitals()">üè• Hospitals</button>
                    <button class="map-control-btn" onclick="getCurrentLocation()">üìç My Location</button>
                </div>
                <div id="map"></div>
            </div>
        </section>

        <!-- Emergency Section -->
        <section id="emergency" class="section">
            <h2 class="section-title brand-font">Emergency Support</h2>
            <p>24/7 emergency assistance and support for travelers worldwide.</p>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="emergency-button" onclick="triggerEmergency()" style="font-size: 1.2rem; padding: 1.5rem 3rem;">
                    üö® EMERGENCY ASSISTANCE
                </button>
                <p style="margin-top: 1rem; color: var(--text-light);">
                    Click only in case of real emergency. This will attempt to contact local emergency services.
                </p>
            </div>
        </section>
    </main>

    <!-- Emergency Modal -->
    <div id="emergency-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('emergency-modal')">&times;</button>
            <h3>Emergency Contacts</h3>
            <div id="emergency-contacts">
                <!-- Emergency contacts will be populated here -->
            </div>
        </div>
    </div>

    <!-- Safety Tips Modal -->
    <div id="safety-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('safety-modal')">&times;</button>
            <h3>Safety Tips</h3>
            <div id="safety-tips">
                <!-- Safety tips will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let map;
        let userLocation;
        let placesService;
        let autocompleteService;
        let markersArray = [];

        // AI Configuration - Using Google Gemini API
        // For production: Use environment variables or serverless functions to keep keys secure
        const AI_API_KEY = 'AIzaSyCTvaHSOhBtsLlfA0GPCFBa2kJnReoh4FI';
        const AI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';        // Initialize Google Maps
        function initMap() {
            console.log('initMap called');
            try {
                if (typeof google === 'undefined' || !google.maps) {
                    console.error('Google Maps API not loaded');
                    showMapFallback();
                    return;
                }

                console.log('Google Maps API is available');
                const defaultLocation = { lat: 40.7128, lng: -74.0060 };
                
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    console.error('Map element not found');
                    return;
                }

                console.log('Creating Google Map...');
                map = new google.maps.Map(mapElement, {
                    zoom: 13,
                    center: defaultLocation,
                    styles: [
                        {
                            featureType: 'poi',
                            elementType: 'labels',
                            stylers: [{ visibility: 'on' }]
                        }
                    ]
                });

                console.log('Map created successfully');

                placesService = new google.maps.places.PlacesService(map);
                autocompleteService = new google.maps.places.AutocompleteService();

                // Try to get user's current location
                getCurrentLocation();

                // Setup destination autocomplete
                setupDestinationAutocomplete();

                // Initialize Places Autocomplete for better reliability
                initPlacesAutocomplete();
                
                console.log('Google Maps initialized successfully');
            } catch (error) {
                console.error('Error initializing Google Maps:', error);
                showMapFallback();
            }
        }

        function showMapFallback() {
            const mapElement = document.getElementById('map');
            if (mapElement) {
                mapElement.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; font-size: 1.1rem; border-radius: 15px;">
                        <div>
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üó∫Ô∏è</div>
                            <div style="font-size: 1.3rem; margin-bottom: 0.5rem;">Interactive Map</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Will load your destination when selected</div>
                        </div>
                    </div>
                `;
            }
            // Still setup a basic autocomplete for destinations
            setupBasicAutocomplete();
        }

        function setupBasicAutocomplete() {
            console.log('Setting up basic autocomplete fallback');
            const destinationInput = document.getElementById('destination');
            if (destinationInput) {
                // Add basic city suggestions
                const popularDestinations = [
                    'New York, NY, USA', 'Paris, France', 'Tokyo, Japan', 'London, UK',
                    'Rome, Italy', 'Barcelona, Spain', 'Amsterdam, Netherlands',
                    'Berlin, Germany', 'Bangkok, Thailand', 'Sydney, Australia',
                    'Los Angeles, CA, USA', 'Dubai, UAE', 'Singapore', 'Vienna, Austria',
                    'Prague, Czech Republic', 'Istanbul, Turkey', 'Cairo, Egypt'
                ];

                destinationInput.addEventListener('input', function() {
                    const value = this.value.toLowerCase();
                    if (value.length < 2) return;

                    const suggestions = popularDestinations.filter(dest => 
                        dest.toLowerCase().includes(value)
                    ).slice(0, 5);

                    showBasicSuggestions(suggestions, this);
                });
            }
        }

        function showBasicSuggestions(suggestions, inputElement) {
            // Remove existing suggestions
            const existingSuggestions = document.getElementById('basic-suggestions');
            if (existingSuggestions) {
                existingSuggestions.remove();
            }

            if (suggestions.length === 0) return;

            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.id = 'basic-suggestions';
            suggestionsDiv.className = 'suggestions-dropdown';
            suggestionsDiv.style.display = 'block';

            suggestions.forEach(suggestion => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = suggestion;
                item.addEventListener('click', () => {
                    inputElement.value = suggestion;
                    suggestionsDiv.remove();
                });
                suggestionsDiv.appendChild(item);
            });

            inputElement.parentNode.appendChild(suggestionsDiv);

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!inputElement.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.remove();
                }
            }, { once: true });
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        map.setCenter(userLocation);
                        
                        // Add marker for user location
                        new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            title: 'Your Location',
                            icon: {
                                url: 'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%234285f4"><circle cx="12" cy="12" r="8"/></svg>',
                                scaledSize: new google.maps.Size(20, 20)
                            }
                        });
                    },
                    (error) => {
                        console.log('Error getting location:', error);
                    }
                );
            }
        }

        function setupDestinationAutocomplete() {
            const destinationInput = document.getElementById('destination');
            const suggestionsDiv = document.getElementById('destination-suggestions');

            if (!destinationInput || !suggestionsDiv) {
                console.error('Destination input or suggestions div not found');
                return;
            }

            destinationInput.addEventListener('input', function() {
                const value = this.value.trim();
                if (value.length < 3) {
                    suggestionsDiv.style.display = 'none';
                    return;
                }

                if (autocompleteService) {
                    autocompleteService.getPlacePredictions({
                        input: value,
                        types: ['(cities)']
                    }, (predictions, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK && predictions) {
                            displaySuggestions(predictions, suggestionsDiv);
                        } else {
                            console.log('Autocomplete status:', status);
                            suggestionsDiv.style.display = 'none';
                        }
                    });
                } else {
                    console.error('Autocomplete service not initialized');
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!destinationInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });
        }

        function displaySuggestions(predictions, container) {
            container.innerHTML = '';
            container.style.display = 'block';

            predictions.slice(0, 5).forEach(prediction => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = prediction.description;
                item.addEventListener('click', () => {
                    document.getElementById('destination').value = prediction.description;
                    container.style.display = 'none';
                    
                    // Update map to show selected destination
                    geocodeDestination(prediction.description);
                });
                container.appendChild(item);
            });
        }

        function geocodeDestination(destination) {
            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: destination }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    const location = results[0].geometry.location;
                    map.setCenter(location);
                    map.setZoom(12);
                    
                    // Clear previous markers
                    clearMarkers();
                    
                    // Add marker for destination
                    new google.maps.Marker({
                        position: location,
                        map: map,
                        title: destination,
                        icon: {
                            url: 'data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ea4335"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>',
                            scaledSize: new google.maps.Size(40, 40)
                        }
                    });
                }
            });
        }

        // Alternative autocomplete implementation using Google Places Autocomplete widget
        function initPlacesAutocomplete() {
            try {
                const destinationInput = document.getElementById('destination');
                if (destinationInput && typeof google !== 'undefined' && google.maps && google.maps.places) {
                    const autocomplete = new google.maps.places.Autocomplete(destinationInput, {
                        types: ['(cities)'],
                        fields: ['place_id', 'geometry', 'name', 'formatted_address']
                    });

                    autocomplete.addListener('place_changed', function() {
                        const place = autocomplete.getPlace();
                        if (place.geometry && map) {
                            map.setCenter(place.geometry.location);
                            map.setZoom(12);
                            clearMarkers();
                            new google.maps.Marker({
                                position: place.geometry.location,
                                map: map,
                                title: place.formatted_address || place.name
                            });
                        }
                    });
                    console.log('Places Autocomplete initialized successfully');
                } else {
                    console.log('Google Maps Places not available, using manual input');
                    if (destinationInput) {
                        destinationInput.placeholder = "Enter destination (e.g., Paris, Tokyo, New York)";
                    }
                }
            } catch (error) {
                console.error('Error initializing Places Autocomplete:', error);
            }
        }

        function findNearbyAttractions() {
            findNearbyPlaces('tourist_attraction', 'üéØ');
        }

        function findNearbyRestaurants() {
            findNearbyPlaces('restaurant', 'üçΩÔ∏è');
        }

        function findNearbyHospitals() {
            findNearbyPlaces('hospital', 'üè•');
        }

        function findNearbyPlaces(type, icon) {
            const center = map.getCenter();
            const request = {
                location: center,
                radius: 2000,
                type: [type]
            };

            clearMarkers();

            placesService.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    results.slice(0, 10).forEach(place => {
                        const marker = new google.maps.Marker({
                            position: place.geometry.location,
                            map: map,
                            title: place.name,
                            icon: {
                                url: `data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23059669"><circle cx="12" cy="12" r="10"/><text x="12" y="16" text-anchor="middle" fill="white" font-size="12">${icon}</text></svg>`,
                                scaledSize: new google.maps.Size(30, 30)
                            }
                        });

                        const infoWindow = new google.maps.InfoWindow({
                            content: `<div><strong>${place.name}</strong><br>Rating: ${place.rating || 'N/A'}<br>${place.vicinity}</div>`
                        });

                        marker.addListener('click', () => {
                            infoWindow.open(map, marker);
                        });

                        markersArray.push(marker);
                    });
                }
            });
        }

        function clearMarkers() {
            markersArray.forEach(marker => marker.setMap(null));
            markersArray = [];
        }

        // Status message helper function
        function showStatusMessage(message, type = 'info') {
            const statusDiv = document.getElementById('status-messages');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = `<div style="color: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#007bff'}; font-weight: bold;">${message}</div>`;
            
            // Auto-hide after 5 seconds unless it's an error
            if (type !== 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // AI-Powered Itinerary Generation with Enhanced Intelligence
        async function generateItineraryWithAI() {
            const form = document.getElementById('itinerary-form');
            const formData = new FormData(form);
            const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked')).map(cb => cb.value);
            
            const destination = formData.get('destination');
            const startDate = formData.get('start-date');
            const endDate = formData.get('end-date');
            const budget = formData.get('budget');
            const accommodation = formData.get('accommodation');
            const transportation = formData.get('transportation');
            const groupSize = formData.get('group-size');
            const dietary = formData.get('dietary');

            if (!destination || !startDate || !endDate) {
                showStatusMessage('Please fill in all required fields (destination, start date, end date)', 'error');
                return;
            }

            // Validate destination is a real place
            const cleanDestination = destination.toLowerCase().trim();
            if (cleanDestination.includes('test') || cleanDestination.includes('haha') || cleanDestination.includes('doesnt') || cleanDestination.length < 3) {
                showStatusMessage('Please enter a real destination (e.g., Paris, Tokyo, New York)', 'error');
                return;
            }

            // Show loading and status
            showStatusMessage('Starting AI itinerary generation...', 'info');
            document.getElementById('loading').style.display = 'block';
            document.getElementById('itinerary-results').style.display = 'none';

            try {
                // Calculate trip duration and season
                const start = new Date(startDate);
                const end = new Date(endDate);
                const duration = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                const month = start.toLocaleDateString('en-US', { month: 'long' });
                const season = getSeason(start.getMonth());

                // Enhanced AI prompt with more context and intelligence
                const prompt = `You are an expert travel agent with deep knowledge of global destinations, local cultures, and travel logistics. Create a highly detailed, personalized travel itinerary.

DESTINATION ANALYSIS:
- Location: ${destination}
- Travel Dates: ${startDate} to ${endDate} (${duration} days)
- Season: ${month} (${season})
- Budget Level: ${budget}
- Group: ${groupSize}
- Accommodation Style: ${accommodation}
- Transportation: ${transportation}
- Dietary Requirements: ${dietary || 'None'}
- Interests: ${interests.join(', ') || 'General exploration'}

REQUIREMENTS:
1. Research the destination's culture, climate, and current season
2. Consider local events, festivals, or seasonal activities happening during the visit
3. Provide specific, real venue names and locations where possible
4. Include cultural etiquette tips and local customs
5. Suggest authentic local experiences beyond typical tourist activities
6. Consider travel logistics, opening hours, and practical timing
7. Include backup indoor activities for potential weather issues
8. Provide realistic cost estimates in local currency and USD
9. Consider the group dynamics and age-appropriate activities
10. Include safety considerations and local emergency information

ENHANCED OUTPUT FORMAT (JSON):
{
  "destination_overview": {
    "climate": "Weather description for travel dates",
    "culture_highlights": ["Cultural insight 1", "Cultural insight 2"],
    "local_currency": "Currency name and approximate exchange rate",
    "language_basics": ["Hello in local language", "Thank you", "Excuse me"],
    "tipping_customs": "Local tipping practices",
    "best_neighborhoods": ["Area 1 with description", "Area 2 with description"]
  },
  "days": [
    {
      "day": 1,
      "date": "${start.toLocaleDateString()}",
      "theme": "Arrival & Orientation",
      "weather_consideration": "Expected weather and recommendations",
      "activities": [
        {
          "time": "9:00 AM",
          "title": "Specific Activity Name",
          "location": "Exact address or landmark",
          "description": "Detailed description with why this is recommended",
          "duration": "2 hours",
          "cost": {
            "amount": "Price range",
            "currency": "Local currency",
            "usd_equivalent": "$XX-XX"
          },
          "type": "arrival/sightseeing/food/culture/adventure",
          "insider_tip": "Local secret or pro tip",
          "backup_option": "Alternative if weather/closure issues"
        }
      ],
      "meals": {
        "breakfast": {
          "restaurant": "Specific restaurant name",
          "specialty": "What to order",
          "cost": "$XX",
          "why_recommended": "Reason for selection"
        },
        "lunch": {
          "restaurant": "Name",
          "specialty": "Dish",
          "cost": "$XX",
          "why_recommended": "Reason"
        },
        "dinner": {
          "restaurant": "Name",
          "specialty": "Dish",
          "cost": "$XX",
          "why_recommended": "Reason"
        }
      },
      "transportation_notes": "How to get around today, costs, tips",
      "cultural_insight": "Something interesting about local culture relevant to today",
      "safety_tip": "Specific safety advice for today's activities",
      "photo_opportunities": ["Best photo spot 1", "Best photo spot 2"]
    }
  ],
  "practical_information": {
    "total_estimated_cost": {
      "budget_breakdown": {
        "accommodation": "$XXX",
        "food": "$XXX",
        "activities": "$XXX",
        "transportation": "$XXX",
        "shopping": "$XXX"
      },
      "total_per_person": "$XXX",
      "total_for_group": "$XXX"
    },
    "packing_essentials": ["Item 1 with reason", "Item 2 with reason"],
    "local_apps": ["Useful app 1", "Useful app 2"],
    "emergency_contacts": {
      "police": "Local number",
      "medical": "Local number",
      "tourist_helpline": "If available"
    },
    "cultural_dos_and_donts": {
      "dos": ["Do this", "Do that"],
      "donts": ["Don't do this", "Don't do that"]
    }
  },
  "hidden_gems": ["Secret spot 1 with description", "Secret spot 2 with description"],
  "local_events": "Any festivals, markets, or special events during the visit",
  "sustainable_travel_tips": ["Eco-friendly option 1", "Eco-friendly option 2"],
  "contingency_plans": {
    "rainy_day": ["Indoor activity 1", "Indoor activity 2"],
    "budget_cuts": ["Free/cheap alternative 1", "Free/cheap alternative 2"],
    "extra_time": ["Bonus activity 1", "Bonus activity 2"]
  }
}

Provide this as clean JSON only. Make it personal, practical, and memorable. Include real places, specific recommendations, and insider knowledge that makes this trip special.`;

                // Call Gemini with enhanced prompt
                showStatusMessage('Connecting to AI service...', 'info');
                console.log('Calling Gemini API with destination:', destination);
                const response = await fetch(`${AI_API_URL}?key=${AI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt  // Use the prompt directly without extra system message
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 4000,
                            candidateCount: 1
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Gemini API Error:', response.status, errorText);
                    throw new Error(`AI service unavailable: ${response.status}`);
                }

                const data = await response.json();
                console.log('Gemini API Response:', data);

                // Parse Gemini response
                if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
                    try {
                        showStatusMessage('Processing AI response...', 'info');
                        const itineraryText = data.candidates[0].content.parts[0].text;
                        console.log('Raw AI response:', itineraryText);
                        
                        // Clean the response to extract JSON
                        const jsonStart = itineraryText.indexOf('{');
                        const jsonEnd = itineraryText.lastIndexOf('}') + 1;
                        
                        if (jsonStart === -1 || jsonEnd === 0) {
                            throw new Error('No JSON found in response');
                        }
                        
                        const jsonString = itineraryText.substring(jsonStart, jsonEnd);
                        console.log('Extracted JSON:', jsonString);
                        
                        const itinerary = JSON.parse(jsonString);
                        showStatusMessage('AI itinerary generated successfully!', 'success');
                        displayEnhancedAIItinerary(itinerary);
                    } catch (parseError) {
                        console.error('AI response parsing failed:', parseError);
                        console.log('Raw response text:', data.candidates[0].content.parts[0].text);
                        showStatusMessage('AI response format error. Generating fallback itinerary...', 'error');
                        generateFallbackItinerary(destination, startDate, endDate, interests, budget, groupSize);
                    }
                } else {
                    console.error('Invalid Gemini response structure:', data);
                    throw new Error('Invalid AI response format');
                }
            } catch (error) {
                console.error('AI Generation failed:', error);
                showStatusMessage('AI service is currently unavailable. Generating fallback itinerary...', 'error');
                generateFallbackItinerary(destination, startDate, endDate, interests, budget, groupSize);
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('itinerary-results').style.display = 'block';
        }

        // Create a fallback itinerary when AI fails
        function generateFallbackItinerary(destination, startDate, endDate, interests, budget, groupSize) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const duration = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            
            const fallbackItinerary = {
                destination_overview: {
                    climate: `Weather information for ${destination} in ${start.toLocaleDateString('en-US', { month: 'long' })}`,
                    culture_highlights: [`Local culture of ${destination}`, "Traditional customs and practices"],
                    local_currency: "Local currency information",
                    language_basics: ["Hello", "Thank you", "Please"],
                    tipping_customs: "Standard tipping practices",
                    best_neighborhoods: [`Central ${destination}`, `Historic district of ${destination}`]
                },
                days: []
            };

            // Generate days based on interests and preferences
            for (let i = 0; i < duration; i++) {
                const currentDate = new Date(start);
                currentDate.setDate(start.getDate() + i);
                
                const dayActivities = [];
                const selectedInterests = interests.length > 0 ? interests : ['food', 'history', 'nature'];
                
                // Morning activity based on interests
                const morningInterest = selectedInterests[i % selectedInterests.length];
                dayActivities.push({
                    time: "9:00 AM",
                    duration: "3 hours",
                    title: getActivityByInterest(morningInterest, destination),
                    location: `${destination} ${morningInterest} district`,
                    description: `Explore ${destination}'s ${morningInterest} offerings with this carefully curated experience.`,
                    cost: budget === 'budget' ? '$15-25' : budget === 'mid-range' ? '$30-50' : '$60-100',
                    insider_tip: `Best to visit early in the morning for fewer crowds.`,
                    backup_option: `Indoor alternative available if weather doesn't cooperate.`
                });
                
                // Lunch
                dayActivities.push({
                    time: "12:30 PM",
                    duration: "1.5 hours",
                    title: `Authentic ${destination} Cuisine`,
                    location: `Local restaurant in ${destination}`,
                    description: `Experience traditional flavors and local specialties.`,
                    cost: budget === 'budget' ? '$8-15' : budget === 'mid-range' ? '$20-35' : '$45-70',
                    insider_tip: `Ask locals for their favorite dishes.`,
                    backup_option: `Food courts available for quick options.`
                });
                
                // Afternoon activity
                const afternoonInterest = selectedInterests[(i + 1) % selectedInterests.length];
                dayActivities.push({
                    time: "2:30 PM",
                    duration: "3 hours",
                    title: getActivityByInterest(afternoonInterest, destination),
                    location: `${destination} ${afternoonInterest} area`,
                    description: `Continue your ${destination} adventure with ${afternoonInterest} exploration.`,
                    cost: budget === 'budget' ? '$10-20' : budget === 'mid-range' ? '$25-45' : '$50-80',
                    insider_tip: `Perfect time for photos and cultural immersion.`,
                    backup_option: `Indoor venues available nearby.`
                });

                fallbackItinerary.days.push({
                    day: i + 1,
                    date: currentDate.toLocaleDateString(),
                    theme: i === 0 ? "Arrival & First Impressions" : i === duration - 1 ? "Final Experiences" : `${selectedInterests[i % selectedInterests.length]} Focus`,
                    weather_note: `Check weather forecast for outdoor activities`,
                    activities: dayActivities,
                    meals: {
                        breakfast: `Local caf√© near accommodation`,
                        lunch: `Traditional ${destination} restaurant`,
                        dinner: `Recommended local dining experience`
                    },
                    cultural_insight: `${destination} is known for its rich cultural heritage and welcoming locals.`,
                    photo_opportunities: [`Scenic viewpoints`, `Local architecture`, `Street scenes`]
                });
            }

            fallbackItinerary.practical_information = {
                budget_breakdown: {
                    activities: budget === 'budget' ? '$25-45/day' : budget === 'mid-range' ? '$55-95/day' : '$105-180/day',
                    food: budget === 'budget' ? '$20-35/day' : budget === 'mid-range' ? '$40-70/day' : '$80-150/day',
                    transportation: '$10-25/day',
                    total_estimated: budget === 'budget' ? '$55-105/day' : budget === 'mid-range' ? '$105-190/day' : '$195-355/day'
                },
                packing_essentials: ['Comfortable walking shoes', 'Weather-appropriate clothing', 'Camera', 'Local currency', 'Travel insurance documents'],
                cultural_dos_and_donts: {
                    dos: [`Respect local customs`, `Learn basic local phrases`, `Tip appropriately`],
                    donts: [`Don't ignore local etiquette`, `Don't forget travel insurance`, `Don't overpack your schedule`]
                }
            };

            fallbackItinerary.hidden_gems = [`Hidden local market in ${destination}`, `Secret viewpoint known to locals`, `Traditional workshop experience`];
            fallbackItinerary.local_events = `Check local event calendars for festivals and special activities during your visit`;

            displayEnhancedAIItinerary(fallbackItinerary);
        }

        function getActivityByInterest(interest, destination) {
            const activities = {
                history: `Historical Museum of ${destination}`,
                art: `Local Art Gallery & Studios`,
                food: `Food Market & Cooking Experience`,
                nature: `${destination} Nature Walk`,
                nightlife: `Evening Entertainment District`,
                shopping: `Local Markets & Artisan Shops`,
                adventure: `Outdoor Adventure Activities`,
                wellness: `Spa & Wellness Experience`,
                culture: `Cultural Heritage Sites`,
                photography: `Photography Tour of ${destination}`
            };
            return activities[interest] || `Cultural Experience in ${destination}`;
        }

        // Helper function to determine season
        function getSeason(month) {
            if (month >= 11 || month <= 1) return 'Winter';
            if (month >= 2 && month <= 4) return 'Spring';
            if (month >= 5 && month <= 7) return 'Summer';
            return 'Fall';
        }

        // Enhanced AI itinerary display
        function displayEnhancedAIItinerary(itinerary) {
            const container = document.getElementById('itinerary-results');
            let html = `
                <div class="ai-header">
                    <h3>ü§ñ Your Personalized AI Travel Plan</h3>
                    <div class="destination-overview">
                        <h4>üìç ${itinerary.destination_overview ? 'Destination Insights' : 'Overview'}</h4>
                        ${itinerary.destination_overview ? `
                            <div class="overview-grid">
                                <div class="overview-item">
                                    <strong>üå§Ô∏è Climate:</strong> ${itinerary.destination_overview.climate || 'Check local weather'}
                                </div>
                                <div class="overview-item">
                                    <strong>üí∞ Currency:</strong> ${itinerary.destination_overview.local_currency || 'Local currency'}
                                </div>
                                <div class="overview-item">
                                    <strong>üó£Ô∏è Key Phrases:</strong> ${itinerary.destination_overview.language_basics ? itinerary.destination_overview.language_basics.join(', ') : 'Learn basic greetings'}
                                </div>
                                <div class="overview-item">
                                    <strong>üí° Tipping:</strong> ${itinerary.destination_overview.tipping_customs || 'Research local customs'}
                                </div>
                            </div>
                            ${itinerary.destination_overview.best_neighborhoods ? `
                                <div class="neighborhoods">
                                    <strong>üèòÔ∏è Best Areas to Explore:</strong>
                                    <ul>${itinerary.destination_overview.best_neighborhoods.map(area => `<li>${area}</li>`).join('')}</ul>
                                </div>
                            ` : ''}
                        ` : ''}
                    </div>
                </div>
            `;

            // Enhanced day-by-day display
            if (itinerary.days) {
                itinerary.days.forEach(day => {
                    html += `
                        <div class="enhanced-day-card">
                            <div class="day-header">
                                <div class="day-title">Day ${day.day} - ${day.date}</div>
                                <div class="day-theme">${day.theme || 'Exploration'}</div>
                            </div>
                            
                            ${day.weather_consideration ? `
                                <div class="weather-note">
                                    <strong>üå§Ô∏è Weather:</strong> ${day.weather_consideration}
                                </div>
                            ` : ''}

                            <div class="activities-section">
                                ${day.activities ? day.activities.map(activity => `
                                    <div class="enhanced-activity">
                                        <div class="activity-header">
                                            <span class="activity-time">${activity.time}</span>
                                            <span class="activity-duration">${activity.duration || ''}</span>
                                        </div>
                                        <div class="activity-title">${activity.title}</div>
                                        <div class="activity-location">üìç ${activity.location || ''}</div>
                                        <p class="activity-description">${activity.description}</p>
                                        
                                        ${activity.cost ? `
                                            <div class="activity-cost">
                                                üí∞ ${activity.cost.amount || activity.cost} ${activity.cost.usd_equivalent ? `(${activity.cost.usd_equivalent})` : ''}
                                            </div>
                                        ` : ''}
                                        
                                        ${activity.insider_tip ? `
                                            <div class="insider-tip">
                                                üí° <strong>Insider Tip:</strong> ${activity.insider_tip}
                                            </div>
                                        ` : ''}
                                        
                                        ${activity.backup_option ? `
                                            <div class="backup-option">
                                                üîÑ <strong>Backup:</strong> ${activity.backup_option}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('') : ''}
                            </div>

                            ${day.meals ? `
                                <div class="meals-section">
                                    <h5>üçΩÔ∏è Today's Dining</h5>
                                    <div class="meals-grid">
                                        ${day.meals.breakfast ? `
                                            <div class="meal-item">
                                                <strong>üåÖ Breakfast:</strong> ${day.meals.breakfast.restaurant}<br>
                                                <em>Try: ${day.meals.breakfast.specialty}</em> (${day.meals.breakfast.cost})<br>
                                                <small>${day.meals.breakfast.why_recommended}</small>
                                            </div>
                                        ` : ''}
                                        ${day.meals.lunch ? `
                                            <div class="meal-item">
                                                <strong>‚òÄÔ∏è Lunch:</strong> ${day.meals.lunch.restaurant}<br>
                                                <em>Try: ${day.meals.lunch.specialty}</em> (${day.meals.lunch.cost})<br>
                                                <small>${day.meals.lunch.why_recommended}</small>
                                            </div>
                                        ` : ''}
                                        ${day.meals.dinner ? `
                                            <div class="meal-item">
                                                <strong>üåô Dinner:</strong> ${day.meals.dinner.restaurant}<br>
                                                <em>Try: ${day.meals.dinner.specialty}</em> (${day.meals.dinner.cost})<br>
                                                <small>${day.meals.dinner.why_recommended}</small>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            ` : ''}

                            <div class="day-extras">
                                ${day.cultural_insight ? `
                                    <div class="cultural-insight">
                                        üèõÔ∏è <strong>Cultural Insight:</strong> ${day.cultural_insight}
                                    </div>
                                ` : ''}
                                
                                ${day.photo_opportunities ? `
                                    <div class="photo-ops">
                                        üì∏ <strong>Photo Spots:</strong> ${day.photo_opportunities.join(', ')}
                                    </div>
                                ` : ''}
                                
                                <div class="safety-alert">
                                    <h4>üõ°Ô∏è Today's Safety Tip</h4>
                                    <p>${day.safety_tip || 'Stay aware of your surroundings and keep valuables secure.'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            // Enhanced practical information
            if (itinerary.practical_information) {
                const practical = itinerary.practical_information;
                html += `
                    <div class="practical-info-section">
                        <h3>üìã Practical Information</h3>
                        
                        ${practical.total_estimated_cost ? `
                            <div class="budget-breakdown">
                                <h4>üí∞ Budget Breakdown (${practical.total_estimated_cost.total_per_person || 'Per Person'})</h4>
                                ${practical.total_estimated_cost.budget_breakdown ? `
                                    <div class="budget-grid">
                                        ${Object.entries(practical.total_estimated_cost.budget_breakdown).map(([category, amount]) => `
                                            <div class="budget-item">
                                                <span class="budget-category">${category.charAt(0).toUpperCase() + category.slice(1)}:</span>
                                                <span class="budget-amount">${amount}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                ${practical.total_estimated_cost.total_for_group ? `
                                    <div class="total-budget">
                                        <strong>Total for Group: ${practical.total_estimated_cost.total_for_group}</strong>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        ${practical.packing_essentials ? `
                            <div class="packing-section">
                                <h4>üéí Packing Essentials</h4>
                                <ul class="packing-list">
                                    ${practical.packing_essentials.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        ${practical.cultural_dos_and_donts ? `
                            <div class="culture-section">
                                <h4>ü§ù Cultural Guidelines</h4>
                                <div class="dos-donts-grid">
                                    <div class="dos">
                                        <h5>‚úÖ DO:</h5>
                                        <ul>${practical.cultural_dos_and_donts.dos.map(item => `<li>${item}</li>`).join('')}</ul>
                                    </div>
                                    <div class="donts">
                                        <h5>‚ùå DON'T:</h5>
                                        <ul>${practical.cultural_dos_and_donts.donts.map(item => `<li>${item}</li>`).join('')}</ul>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // Hidden gems and extras
            if (itinerary.hidden_gems || itinerary.local_events) {
                html += `
                    <div class="extras-section">
                        ${itinerary.hidden_gems ? `
                            <div class="hidden-gems">
                                <h4>üíé Hidden Gems</h4>
                                <ul>${itinerary.hidden_gems.map(gem => `<li>${gem}</li>`).join('')}</ul>
                            </div>
                        ` : ''}
                        
                        ${itinerary.local_events ? `
                            <div class="local-events">
                                <h4>üéâ Special Events</h4>
                                <p>${itinerary.local_events}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function displayAIItinerary(itinerary) {
            const container = document.getElementById('itinerary-results');
            let html = `
                <h3>ü§ñ AI-Generated Personalized Itinerary</h3>
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #ecfdf5 100%); padding: 1rem; border-radius: 10px; margin-bottom: 2rem;">
                    <h4>üí∞ Total Estimated Cost: ${itinerary.totalEstimatedCost || 'Budget varies'}</h4>
                </div>
            `;
            
            itinerary.days.forEach(day => {
                html += `
                    <div class="day-card">
                        <div class="day-title">Day ${day.day} - ${day.date}</div>
                        ${day.activities.map(activity => `
                            <div class="activity">
                                <div class="activity-time">${activity.time}</div>
                                <div class="activity-title">${activity.title}</div>
                                <p>${activity.description}</p>
                                ${activity.cost ? `<div style="color: #059669; font-weight: 600;">üí∞ ${activity.cost}</div>` : ''}
                            </div>
                        `).join('')}
                        <div class="safety-alert">
                            <h4>üõ°Ô∏è Safety Tip for Today</h4>
                            <p>${day.safetyTip}</p>
                        </div>
                    </div>
                `;
            });

            if (itinerary.generalTips && itinerary.generalTips.length > 0) {
                html += `
                    <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 10px; padding: 1rem; margin-top: 2rem;">
                        <h4 style="color: #92400e; margin-bottom: 1rem;">üí° General Travel Tips</h4>
                        <ul style="margin-left: 1rem;">
                            ${itinerary.generalTips.map(tip => `<li style="margin-bottom: 0.5rem;">${tip}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // Update the generate button to use AI
        function generateItinerary() {
            generateItineraryWithAI();
        }

        // Test function to check Gemini API connectivity
        async function testGeminiAPI() {
            console.log('Testing Gemini API...');
            showStatusMessage('Testing AI connection...', 'info');
            
            try {
                const testPrompt = "Say 'Hello! Gemini API is working correctly!' and nothing else.";
                
                const response = await fetch(`${AI_API_URL}?key=${AI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: testPrompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.1,
                            maxOutputTokens: 100,
                            candidateCount: 1
                        }
                    })
                });

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', errorText);
                    showStatusMessage(`‚ùå API Error: ${response.status} - ${errorText}`, 'error');
                    return;
                }

                const data = await response.json();
                console.log('API Response:', data);

                if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const responseText = data.candidates[0].content.parts[0].text;
                    showStatusMessage(`‚úÖ Gemini AI Connection Successful! Response: ${responseText}`, 'success');
                } else {
                    console.error('Unexpected response format:', data);
                    showStatusMessage('‚ùå Unexpected response format from AI service', 'error');
                }
                
            } catch (error) {
                console.error('Test failed:', error);
                showStatusMessage(`‚ùå AI Connection Test Failed: ${error.message}`, 'error');
            }
        }

        // Comprehensive troubleshooting function
        function runDiagnostics() {
            showStatusMessage('Running system diagnostics...', 'info');
            
            const diagnostics = [];
            
            // Check Google Maps
            if (typeof google !== 'undefined' && google.maps) {
                diagnostics.push('‚úÖ Google Maps API loaded');
            } else {
                diagnostics.push('‚ùå Google Maps API not loaded');
            }
            
            // Check Gemini API key
            if (AI_API_KEY && AI_API_KEY !== 'YOUR_GEMINI_API_KEY_HERE') {
                diagnostics.push('‚úÖ Gemini API key configured');
            } else {
                diagnostics.push('‚ùå Gemini API key not configured');
            }
            
            // Check autocomplete
            const destinationInput = document.getElementById('destination');
            if (destinationInput) {
                diagnostics.push('‚úÖ Destination input field found');
            } else {
                diagnostics.push('‚ùå Destination input field not found');
            }
            
            // Check form elements
            const form = document.getElementById('itinerary-form');
            if (form) {
                diagnostics.push('‚úÖ Itinerary form found');
            } else {
                diagnostics.push('‚ùå Itinerary form not found');
            }
            
            // Display results
            const resultMessage = 'System Diagnostics:\n\n' + diagnostics.join('\n');
            showStatusMessage(resultMessage.replace(/\n/g, '<br>'), 'info');
            console.log('Diagnostics:', diagnostics);
        }

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Sample data and functions
        const emergencyNumbers = {
            'default': {
                police: '911',
                ambulance: '911',
                fire: '911'
            },
            'united kingdom': {
                police: '999',
                ambulance: '999',
                fire: '999'
            },
            'france': {
                police: '17',
                ambulance: '15',
                fire: '18'
            },
            'japan': {
                police: '110',
                ambulance: '119',
                fire: '119'
            },
            'australia': {
                police: '000',
                ambulance: '000',
                fire: '000'
            }
        };

        const safetyTipsData = {
            general: [
                "Keep copies of important documents in separate locations",
                "Share your itinerary with trusted contacts",
                "Research local customs and laws before traveling",
                "Keep emergency cash in multiple locations",
                "Stay aware of your surroundings at all times",
                "Trust your instincts - if something feels wrong, leave",
                "Keep your phone charged and carry a portable charger",
                "Learn basic phrases in the local language"
            ],
            specific: {
                'night': "Avoid walking alone at night, especially in unfamiliar areas. Use well-lit, populated routes and consider ride-sharing services.",
                'valuables': "Keep valuables hidden and secure. Use hotel safes and avoid displaying expensive items like jewelry or electronics.",
                'transport': "Use licensed transportation services and verify rates beforehand. Keep doors locked in vehicles and be cautious of pickpockets on public transit.",
                'accommodation': "Research accommodation reviews and location safety. Inform reception of your plans and expected return times."
            }
        };

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function generateItinerary() {
            const form = document.getElementById('itinerary-form');
            const formData = new FormData(form);
            const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked')).map(cb => cb.value);
            
            // Validate required fields
            const destination = formData.get('destination');
            const startDate = formData.get('start-date');
            const endDate = formData.get('end-date');
            
            if (!destination || !startDate || !endDate) {
                alert('Please fill in all required fields');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('itinerary-results').style.display = 'none';

            // Simulate AI processing
            setTimeout(() => {
                const itinerary = createSampleItinerary(destination, startDate, endDate, interests);
                displayItinerary(itinerary);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('itinerary-results').style.display = 'block';
            }, 3000);
        }

        function createSampleItinerary(destination, startDate, endDate, interests) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            
            const activities = {
                history: ['Visit Historical Museum', 'Guided walking tour of old town', 'Ancient monument exploration'],
                art: ['Art Gallery visit', 'Local artist studio tour', 'Street art walking tour'],
                food: ['Food market tour', 'Cooking class', 'Fine dining experience'],
                nature: ['National park hike', 'Botanical garden visit', 'Scenic viewpoint'],
                nightlife: ['Rooftop bar experience', 'Local music venue', 'Night market exploration'],
                shopping: ['Local market shopping', 'Artisan craft shops', 'Souvenir hunting'],
                adventure: ['Rock climbing', 'Water sports', 'Zip lining adventure'],
                relaxation: ['Spa treatment', 'Beach relaxation', 'Meditation session']
            };

            const itinerary = [];
            for (let i = 0; i < days; i++) {
                const currentDate = new Date(start);
                currentDate.setDate(start.getDate() + i);
                
                const dayActivities = [];
                const selectedInterests = interests.length > 0 ? interests : ['history', 'food', 'nature'];
                
                // Morning activity
                const morningInterest = selectedInterests[Math.floor(Math.random() * selectedInterests.length)];
                dayActivities.push({
                    time: '9:00 AM',
                    title: activities[morningInterest][Math.floor(Math.random() * activities[morningInterest].length)],
                    description: `Start your day with an engaging ${morningInterest} experience in ${destination}.`,
                    type: morningInterest
                });
                
                // Lunch
                dayActivities.push({
                    time: '12:30 PM',
                    title: 'Local Cuisine Lunch',
                    description: `Enjoy authentic ${destination} cuisine at a highly-rated local restaurant.`,
                    type: 'food'
                });
                
                // Afternoon activity
                const afternoonInterest = selectedInterests[Math.floor(Math.random() * selectedInterests.length)];
                dayActivities.push({
                    time: '2:30 PM',
                    title: activities[afternoonInterest][Math.floor(Math.random() * activities[afternoonInterest].length)],
                    description: `Continue exploring with a ${afternoonInterest} adventure.`,
                    type: afternoonInterest
                });
                
                // Evening activity
                if (interests.includes('nightlife')) {
                    dayActivities.push({
                        time: '7:00 PM',
                        title: 'Evening Entertainment',
                        description: `Experience ${destination}'s vibrant nightlife scene.`,
                        type: 'nightlife'
                    });
                }
                
                itinerary.push({
                    day: i + 1,
                    date: currentDate.toLocaleDateString(),
                    activities: dayActivities,
                    safetyNote: generateSafetyNote(destination)
                });
            }
            
            return itinerary;
        }

        function generateSafetyNote(destination) {
            const safetyNotes = [
                "Stay in well-lit areas and avoid displaying valuable items.",
                "Keep emergency contacts readily available and inform someone of your plans.",
                "Be aware of local customs and dress codes to respect the culture.",
                "Stay hydrated and protect yourself from sun exposure.",
                "Use reputable transportation services and verify rates beforehand."
            ];
            return safetyNotes[Math.floor(Math.random() * safetyNotes.length)];
        }

        function displayItinerary(itinerary) {
            const container = document.getElementById('itinerary-results');
            let html = '<h3>Your Personalized Itinerary</h3>';
            
            itinerary.forEach(day => {
                html += `
                    <div class="day-card">
                        <div class="day-title">Day ${day.day} - ${day.date}</div>
                        ${day.activities.map(activity => `
                            <div class="activity">
                                <div class="activity-time">${activity.time}</div>
                                <div class="activity-title">${activity.title}</div>
                                <p>${activity.description}</p>
                            </div>
                        `).join('')}
                        <div class="safety-alert">
                            <h4>üõ°Ô∏è Safety Tip for Today</h4>
                            <p>${day.safetyNote}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showEmergencyContacts() {
            const destination = document.getElementById('destination').value.toLowerCase() || 'default';
            const contacts = emergencyNumbers[destination] || emergencyNumbers['default'];
            
            const html = `
                <div style="text-align: center;">
                    <h4>üöî Police: <a href="tel:${contacts.police}" style="color: #ef4444; font-weight: bold;">${contacts.police}</a></h4>
                    <h4>üöë Ambulance: <a href="tel:${contacts.ambulance}" style="color: #ef4444; font-weight: bold;">${contacts.ambulance}</a></h4>
                    <h4>üöí Fire Department: <a href="tel:${contacts.fire}" style="color: #ef4444; font-weight: bold;">${contacts.fire}</a></h4>
                    <p style="margin-top: 1rem; color: #6b7280;">Tap any number to call immediately</p>
                </div>
            `;
            
            document.getElementById('emergency-contacts').innerHTML = html;
            document.getElementById('emergency-modal').style.display = 'block';
        }

        function shareLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const locationUrl = `https://maps.google.com/?q=${lat},${lng}`;
                    
                    // Create shareable message
                    const message = `I'm currently at: ${locationUrl}\n\nSent from go.travel - Stay safe!`;
                    
                    if (navigator.share) {
                        navigator.share({
                            title: 'My Current Location',
                            text: message,
                            url: locationUrl
                        });
                    } else {
                        // Fallback: copy to clipboard
                        navigator.clipboard.writeText(message).then(() => {
                            alert('Location copied to clipboard! Share this with your trusted contacts.');
                        });
                    }
                }, function(error) {
                    alert('Unable to get your location. Please check your browser permissions.');
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }

        function checkSafetyAlerts() {
            const destination = document.getElementById('destination').value || 'your destination';
            
            // Simulate safety alerts
            const alerts = [
                {
                    level: 'info',
                    title: 'Weather Advisory',
                    message: `Light rain expected in ${destination} this evening. Carry an umbrella.`
                },
                {
                    level: 'warning',
                    title: 'Area Advisory',
                    message: `Increased pickpocket activity reported near tourist areas. Stay vigilant.`
                },
                {
                    level: 'info',
                    title: 'Transportation Update',
                    message: `Public transit running normally with minor delays during rush hour.`
                }
            ];
            
            let alertHtml = '<div style="max-height: 300px; overflow-y: auto;">';
            alerts.forEach(alert => {
                const color = alert.level === 'warning' ? '#fbbf24' : '#3b82f6';
                alertHtml += `
                    <div style="border-left: 4px solid ${color}; padding: 1rem; margin-bottom: 1rem; background: #f8fafc;">
                        <h4 style="color: ${alert.level === 'warning' ? '#92400e' : '#1e40af'}; margin-bottom: 0.5rem;">${alert.title}</h4>
                        <p>${alert.message}</p>
                    </div>
                `;
            });
            alertHtml += '</div>';
            
            // Create and show alert modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                    <h3>Current Safety Alerts</h3>
                    ${alertHtml}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showSafetyTips() {
            const destination = document.getElementById('destination').value || 'your destination';
            
            let tipsHtml = `<div style="max-height: 400px; overflow-y: auto;">
                <h4>General Safety Tips for ${destination}:</h4>
                <ul style="padding-left: 1.5rem; margin-bottom: 2rem;">`;
            
            safetyTipsData.general.forEach(tip => {
                tipsHtml += `<li style="margin-bottom: 0.5rem;">${tip}</li>`;
            });
            
            tipsHtml += `</ul><h4>Specific Safety Advice:</h4>`;
            
            Object.entries(safetyTipsData.specific).forEach(([category, tip]) => {
                tipsHtml += `
                    <div style="border-left: 4px solid #059669; padding: 1rem; margin-bottom: 1rem; background: #f0fdf4;">
                        <h5 style="color: #059669; margin-bottom: 0.5rem; text-transform: capitalize;">${category} Safety</h5>
                        <p>${tip}</p>
                    </div>
                `;
            });
            
            tipsHtml += '</div>';
            
            document.getElementById('safety-tips').innerHTML = tipsHtml;
            document.getElementById('safety-modal').style.display = 'block';
        }

        function triggerEmergency() {
            const confirmEmergency = confirm('Are you experiencing a real emergency? This will attempt to contact emergency services.');
            
            if (confirmEmergency) {
                // Show emergency options
                const emergencyHtml = `
                    <div style="text-align: center;">
                        <h3 style="color: #ef4444; margin-bottom: 2rem;">üö® Emergency Response Activated</h3>
                        
                        <div style="margin-bottom: 2rem;">
                            <button onclick="window.open('tel:911')" style="background: #ef4444; color: white; padding: 1rem 2rem; border: none; border-radius: 10px; font-size: 1.2rem; margin: 0.5rem; cursor: pointer; width: 200px;">
                                üìû Call Emergency Services
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <button onclick="sendEmergencyLocation()" style="background: #f59e0b; color: white; padding: 1rem 2rem; border: none; border-radius: 10px; font-size: 1rem; margin: 0.5rem; cursor: pointer; width: 200px;">
                                üìç Share Emergency Location
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <button onclick="showNearbyHospitals()" style="background: #059669; color: white; padding: 1rem 2rem; border: none; border-radius: 10px; font-size: 1rem; margin: 0.5rem; cursor: pointer; width: 200px;">
                                üè• Find Nearby Hospitals
                            </button>
                        </div>
                        
                        <p style="color: #6b7280; font-size: 0.9rem;">
                            If this is not a real emergency, please close this dialog.
                        </p>
                    </div>
                `;
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                        ${emergencyHtml}
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function sendEmergencyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const emergencyMessage = `üö® EMERGENCY ALERT üö®\n\nI need immediate assistance at:\nhttps://maps.google.com/?q=${lat},${lng}\n\nTime: ${new Date().toLocaleString()}\n\nSent from go.travel Emergency System`;
                    
                    if (navigator.share) {
                        navigator.share({
                            title: 'üö® EMERGENCY ALERT',
                            text: emergencyMessage
                        });
                    } else {
                        navigator.clipboard.writeText(emergencyMessage).then(() => {
                            alert('Emergency location copied to clipboard! Send this to your emergency contacts immediately.');
                        });
                    }
                });
            } else {
                alert('Location services not available. Please manually share your location with emergency services.');
            }
        }

        function showNearbyHospitals() {
            // Simulate nearby hospitals data
            const hospitals = [
                { name: 'City General Hospital', distance: '0.8 miles', phone: '(555) 123-4567' },
                { name: 'Emergency Medical Center', distance: '1.2 miles', phone: '(555) 234-5678' },
                { name: 'Regional Healthcare', distance: '2.1 miles', phone: '(555) 345-6789' }
            ];
            
            let hospitalHtml = '<div style="text-align: left;"><h4>Nearest Medical Facilities:</h4>';
            hospitals.forEach(hospital => {
                hospitalHtml += `
                    <div style="border: 1px solid #e5e7eb; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                        <h5 style="margin-bottom: 0.5rem;">${hospital.name}</h5>
                        <p style="color: #6b7280; margin-bottom: 0.5rem;">Distance: ${hospital.distance}</p>
                        <button onclick="window.open('tel:${hospital.phone}')" style="background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 5px; cursor: pointer;">
                            Call ${hospital.phone}
                        </button>
                    </div>
                `;
            });
            hospitalHtml += '</div>';
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                    <h3>üè• Nearby Medical Facilities</h3>
                    ${hospitalHtml}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('start-date').setAttribute('min', today);
            document.getElementById('end-date').setAttribute('min', today);

            // Update end date minimum when start date changes
            document.getElementById('start-date').addEventListener('change', function(e) {
                document.getElementById('end-date').setAttribute('min', e.target.value);
            });

            // Auto-update emergency numbers based on destination
            document.getElementById('destination').addEventListener('input', function(e) {
                const destination = e.target.value.toLowerCase();
                if (emergencyNumbers[destination]) {
                    console.log(`Emergency numbers updated for ${destination}`);
                }
            });
            
            // Add smooth scrolling for navigation
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Handle browser back button
        window.addEventListener('popstate', function() {
            // Close any open modals
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        });

        // Initialize the page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing page...');
            
            // Set default dates
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const weekLater = new Date(today);
            weekLater.setDate(weekLater.getDate() + 7);
            
            document.getElementById('start-date').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('end-date').value = weekLater.toISOString().split('T')[0];
            
            // Initialize basic autocomplete if Google Maps isn't ready
            setTimeout(function() {
                if (typeof google === 'undefined' || !google.maps) {
                    console.log('Google Maps not available, using basic autocomplete');
                    setupBasicAutocomplete();
                    showMapFallback();
                }
            }, 3000);
            
            console.log('Page initialization complete');
        });

        // Make sure initMap is available globally
        window.initMap = initMap;
    </script>
</body>
</html>