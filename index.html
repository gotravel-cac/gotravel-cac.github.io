<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>go.travel - Your AI-Powered Travel Companion | Smart Trip Planning</title>
    <meta name="title" content="go.travel - Your AI-Powered Travel Companion | Smart Trip Planning">
    <meta name="description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta name="keywords" content="travel planning, AI travel, trip planner, travel companion, vacation planning, travel itinerary, smart travel, travel recommendations, travel booking, go travel, go.travel, go">
    <meta name="author" content="go.travel">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://go.travel">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://go.travel">
    <meta property="og:title" content="go.travel - Your AI-Powered Travel Companion">
    <meta property="og:description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta property="og:image" content="https://go.travel/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="go.travel">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://go.travel">
    <meta property="twitter:title" content="go.travel - Your AI-Powered Travel Companion">
    <meta property="twitter:description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta property="twitter:image" content="https://go.travel/twitter-image.jpg">
    <meta name="twitter:creator" content="@gotravel">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon/web-app-manifest-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon/web-app-manifest-512x512.png">
    
    <!-- Additional SEO -->
    <meta name="theme-color" content="#1e3a8a">
    <meta name="msapplication-TileColor" content="#1e3a8a">
    <meta name="application-name" content="go.travel">
    
    <!-- Security & Performance -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- Geo Location -->
    <meta name="geo.region" content="US">
    <meta name="geo.placename" content="United States">
    <meta name="ICBM" content="39.50, -98.35">
    
    <!-- Language and Locale -->
    <meta name="language" content="English">
    <meta property="og:locale" content="en_US">
    
    <!-- DNS Prefetch for performance -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Using embedded Google Maps instead of JavaScript API -->
    <script>
        console.log('Map functionality ready - using embedded Google Maps');
    </script>
    
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="go.travel - Your AI-Powered Travel Companion">
    <meta itemprop="description" content="Discover the world with go.travel's AI-powered travel planning. Get personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.">
    <meta itemprop="image" content="https://go.travel/og-image.jpg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-gradient: linear-gradient(135deg, #1e3a8a 0%, #059669 100%);
            --secondary-gradient: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
            --accent-blue: #1e40af;
            --accent-green: #059669;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f8fafc;
            --white: #ffffff;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        .brand-font {
            font-family: 'Dancing Script', cursive;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--primary-gradient);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            text-decoration: none;
            color: white;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.8;
        }

        /* Hero Section */
        .hero {
            background: var(--primary-gradient);
            color: white;
            padding: 4rem 0;
            text-align: center;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .cta-button {
            background: white;
            color: var(--accent-blue);
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Main Content */
        .main-content {
            padding: 4rem 0;
        }

        .section {
            margin-bottom: 4rem;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Itinerary Generator */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.2s ease;
        }

        .suggestion-item:hover,
        .suggestion-item.active {
            background: #f8fafc;
            border-left: 3px solid var(--accent-blue);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item strong {
            color: var(--accent-blue);
            font-weight: 600;
        }

        .form-group {
            position: relative;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .generate-btn {
            background: var(--secondary-gradient);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 2rem;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Enhanced AI Itinerary Display */
        .ai-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .destination-overview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .overview-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .neighborhoods {
            margin-top: 1rem;
            text-align: left;
        }

        .neighborhoods ul {
            margin-left: 1rem;
            margin-top: 0.5rem;
        }

        .enhanced-day-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--accent-blue);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .day-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .day-theme {
            background: var(--secondary-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .weather-note {
            background: #e0f2fe;
            border: 1px solid #4fc3f7;
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .enhanced-activity {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-green);
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .activity-time {
            font-weight: 700;
            color: var(--accent-green);
            font-size: 1.1rem;
        }

        .activity-duration {
            background: var(--accent-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .activity-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .activity-location {
            color: var(--text-light);
            font-style: italic;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .activity-description {
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .activity-cost {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 6px;
            padding: 0.5rem;
            color: #15803d;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .insider-tip {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        .backup-option {
            background: #f3f4f6;
            border-left: 4px solid #6b7280;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        .meals-section {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .meals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .meal-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .day-extras {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e5e7eb;
        }

        .cultural-insight {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .photo-ops {
            background: #fdf4ff;
            border-left: 4px solid #d946ef;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .practical-info-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .budget-breakdown {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .budget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 8px;
        }

        .budget-category {
            font-weight: 600;
            color: var(--text-dark);
        }

        .budget-amount {
            font-weight: 700;
            color: var(--accent-green);
        }

        .total-budget {
            text-align: center;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--secondary-gradient);
            color: white;
            border-radius: 8px;
            font-size: 1.1rem;
        }

        .packing-section, .culture-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .packing-list {
            list-style: none;
            padding: 0;
        }

        .packing-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
            padding-left: 2rem;
        }

        .packing-list li:before {
            content: "🎒";
            position: absolute;
            left: 0;
        }

        .dos-donts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }

        .dos, .donts {
            padding: 1rem;
            border-radius: 8px;
        }

        .dos {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
        }

        .donts {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
        }

        .extras-section {
            background: linear-gradient(135deg, #fdf4ff 0%, #f3e8ff 100%);
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .hidden-gems, .local-events {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .hidden-gems ul {
            list-style: none;
            padding: 0;
        }

        .hidden-gems li {
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
            padding-left: 2rem;
        }

        .hidden-gems li:before {
            content: "💎";
            position: absolute;
            left: 0;
        }

        /* Map Container */
        .map-container {
            height: 500px;
            min-height: 400px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin: 2rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        @media (max-width: 768px) {
            .map-container {
                height: 300px;
                margin: 1rem 0;
            }
        }

        .map-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .map-control-btn {
            background: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }

        .map-control-btn:hover {
            background: #f3f4f6;
        }

        /* Safety Features */
        .safety-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .safety-card {
            background: linear-gradient(135deg, #fef7ff 0%, #f0f9ff 100%);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
        }

        .safety-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .safety-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .emergency-button {
            background: #ef4444;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
            transition: all 0.3s;
        }

        .emergency-button:hover {
            background: #dc2626;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .safety-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #e5e7eb;
            border-top: 4px solid var(--accent-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "go.travel",
        "url": "https://go.travel",
        "logo": "https://go.travel/logo.png",
        "description": "AI-powered travel companion providing personalized itineraries, smart recommendations, and seamless booking for unforgettable journeys.",
        "sameAs": [
            "https://twitter.com/gotravel",
            "https://facebook.com/gotravel",
            "https://instagram.com/gotravel"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+1-800-GO-TRAVEL",
            "contactType": "customer service",
            "availableLanguage": ["English", "Spanish", "French", "German"]
        },
        "address": {
            "@type": "PostalAddress",
            "addressCountry": "US"
        },
        "foundingDate": "2024",
        "founder": {
            "@type": "Person",
            "name": "go.travel Team"
        },
        "serviceType": "Travel Planning Service",
        "areaServed": "Worldwide"
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "go.travel",
        "url": "https://go.travel",
        "description": "Your AI-Powered Travel Companion for smart trip planning and personalized travel experiences.",
        "publisher": {
            "@type": "Organization",
            "name": "go.travel"
        },
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://go.travel/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
</head>
<body>
    <header>
        <nav class="container">
            <a href="#" class="logo brand-font" style="display: flex; align-items: center; gap: 0.5rem;">
                <img src="gotravel.png" alt="go.travel logo" style="height: 40px; width: 40px; object-fit: contain; vertical-align: middle;">
                go.travel
            </a>
            <ul class="nav-links">
                <li><a href="#itinerary">Plan Trip</a></li>
                <li><a href="#safety">Safety</a></li>
                <li><a href="#map">Map</a></li>
                <li><a href="#emergency">Emergency</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="container">
            <h1 class="brand-font">Your AI-Powered Travel Companion</h1>
            <p>Revolutionizing travel safety and ease for adventurers worldwide</p>
            <button class="cta-button" onclick="scrollToSection('itinerary')">Start Planning Your Journey</button>
        </div>
    </section>

    <main class="main-content container">
        <!-- AI-Powered Itinerary Generator -->
        <section id="itinerary" class="section">
            <h2 class="section-title brand-font">AI-Powered Itinerary Generator</h2>
            <p>Tell us about your dream trip and let our AI create the perfect personalized itinerary for you.</p>
            
            <form id="itinerary-form" class="form-grid">
                <div class="form-group">
                    <label for="destination">Destination</label>
                    <input type="text" id="destination" name="destination" placeholder="Where are you going?" autocomplete="off" required>
                    <div id="destination-suggestions" class="suggestions-dropdown"></div>
                </div>
                
                <div class="form-group">
                    <label for="start-date">Start Date</label>
                    <input type="date" id="start-date" name="start-date" required>
                </div>
                
                <div class="form-group">
                    <label for="end-date">End Date</label>
                    <input type="date" id="end-date" name="end-date" required>
                </div>
                
                <div class="form-group">
                    <label for="budget">Budget Range</label>
                    <select id="budget" name="budget" required>
                        <option value="">Select budget range</option>
                        <option value="budget">Budget ($0-$50/day)</option>
                        <option value="mid-range">Mid-range ($50-$150/day)</option>
                        <option value="luxury">Luxury ($150+/day)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="accommodation">Accommodation Preference</label>
                    <select id="accommodation" name="accommodation" required>
                        <option value="">Select accommodation type</option>
                        <option value="hostel">Hostel</option>
                        <option value="hotel">Hotel</option>
                        <option value="resort">Resort</option>
                        <option value="airbnb">Airbnb/Vacation Rental</option>
                        <option value="camping">Camping</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="transportation">Transportation Preference</label>
                    <select id="transportation" name="transportation" required>
                        <option value="">Select transportation</option>
                        <option value="walking">Walking/Public Transit</option>
                        <option value="rental-car">Rental Car</option>
                        <option value="rideshare">Rideshare/Taxi</option>
                        <option value="bicycle">Bicycle</option>
                        <option value="mixed">Mixed</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="dietary">Dietary Restrictions</label>
                    <input type="text" id="dietary" name="dietary" placeholder="e.g., vegetarian, gluten-free, halal">
                </div>
                
                <div class="form-group">
                    <label for="group-size">Group Size</label>
                    <select id="group-size" name="group-size" required>
                        <option value="1">Solo traveler</option>
                        <option value="2">Couple</option>
                        <option value="3-4">Small group (3-4)</option>
                        <option value="5+">Large group (5+)</option>
                    </select>
                </div>
            </form>
            
            <div class="form-group">
                <label>Interests (Select all that apply)</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="history" name="interests" value="history">
                        <label for="history">History & Culture</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="nightlife" name="interests" value="nightlife">
                        <label for="nightlife">Nightlife</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="nature" name="interests" value="nature">
                        <label for="nature">Nature & Outdoors</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="art" name="interests" value="art">
                        <label for="art">Art & Museums</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="food" name="interests" value="food">
                        <label for="food">Food & Dining</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="shopping" name="interests" value="shopping">
                        <label for="shopping">Shopping</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="adventure" name="interests" value="adventure">
                        <label for="adventure">Adventure Sports</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="relaxation" name="interests" value="relaxation">
                        <label for="relaxation">Relaxation & Wellness</label>
                    </div>
                </div>
            </div>
            
            <button type="button" class="generate-btn" onclick="generateItinerary()">Generate My Perfect Itinerary</button>
            <button type="button" class="generate-btn" onclick="testGeminiAPI()" style="background: #28a745; margin-left: 1rem;">Test AI Connection</button>
            <button type="button" class="generate-btn" onclick="runDiagnostics()" style="background: #ffc107; color: #000; margin-left: 1rem;">Run Diagnostics</button>
            
            <div id="status-messages" style="margin: 1rem 0; padding: 1rem; border-radius: 8px; display: none;">
                <!-- Status messages will appear here -->
            </div>
            
            <div id="help-tips" style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                <h4 style="margin: 0 0 0.5rem 0; color: #007bff;">💡 Quick Tips:</h4>
                <ul style="margin: 0; padding-left: 1.5rem;">
                    <li>Start typing in the destination field to see autocomplete suggestions</li>
                    <li>Use "Test AI Connection" to verify the AI service is working</li>
                    <li>Use "Run Diagnostics" if you experience any issues</li>
                    <li>Select your interests to get personalized recommendations</li>
                </ul>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Creating your personalized itinerary...</p>
            </div>
            
            <div class="itinerary-container" id="itinerary-results">
                <!-- Generated itinerary will appear here -->
            </div>
        </section>

        <!-- Safety Features -->
        <section id="safety" class="section">
            <h2 class="section-title brand-font">Traveler Safety Features</h2>
            <p>Your safety is our priority. Access essential safety tools and information for your destination.</p>
            
            <div class="safety-grid">
                <div class="safety-card">
                    <div class="safety-icon">🚨</div>
                    <h3>Emergency Contacts</h3>
                    <p>Quick access to local emergency numbers and services</p>
                    <button class="emergency-button" onclick="showEmergencyContacts()">View Emergency Numbers</button>
                </div>
                
                <div class="safety-card">
                    <div class="safety-icon">📍</div>
                    <h3>Live Location Sharing</h3>
                    <p>Share your location with trusted contacts for added security</p>
                    <button class="cta-button" onclick="shareLocation()">Share Location</button>
                </div>
                
                <div class="safety-card">
                    <div class="safety-icon">🛡️</div>
                    <h3>Safety Tips</h3>
                    <p>Personalized safety recommendations for your destination</p>
                    <button class="cta-button" onclick="showSafetyTips()">Get Safety Tips</button>
                </div>
            </div>
        </section>

        <!-- Interactive Map -->
        <section id="map" class="section">
            <h2 class="section-title brand-font">Interactive Navigation Map</h2>
            <p>Navigate your destination with our integrated map featuring location search and directions.</p>
            <div class="map-container" id="map-container">
                <div class="map-controls">
                    <input type="text" id="map-search" placeholder="Search for a location..." style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 5px; width: 200px; margin-right: 10px;">
                    <button class="map-control-btn" onclick="searchLocation()">🔍 Search</button>
                    <button class="map-control-btn" onclick="showUserLocation()">📍 My Location</button>
                    <button class="map-control-btn" onclick="resetMap()">Reset</button>
                </div>
                <div id="map">
                    <!-- Embedded Google Maps as fallback -->
                    <iframe 
                        id="map-iframe"
                        width="100%" 
                        height="100%" 
                        frameborder="0" 
                        style="border:0; border-radius: 15px;" 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d387191.03576085537!2d-74.30932802095712!3d40.69753993989901!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c24fa5d33f083b%3A0xc80b8f06e177fe62!2sNew%20York%2C%20NY%2C%20USA!5e0!3m2!1sen!2sus!4v1635959045123!5m2!1sen!2sus"
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </section>

        <!-- Emergency Section -->
        <section id="emergency" class="section">
            <h2 class="section-title brand-font">Emergency Support</h2>
            <p>24/7 emergency assistance and support for travelers worldwide.</p>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="emergency-button" onclick="triggerEmergency()" style="font-size: 1.2rem; padding: 1.5rem 3rem;">
                    🚨 EMERGENCY ASSISTANCE
                </button>
                <p style="margin-top: 1rem; color: var(--text-light);">
                    Click only in case of real emergency. This will attempt to contact local emergency services.
                </p>
            </div>
        </section>
    </main>

    <!-- Emergency Modal -->
    <div id="emergency-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('emergency-modal')">&times;</button>
            <h3>Emergency Contacts</h3>
            <div id="emergency-contacts">
                <!-- Emergency contacts will be populated here -->
            </div>
        </div>
    </div>

    <!-- Safety Tips Modal -->
    <div id="safety-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('safety-modal')">&times;</button>
            <h3>Safety Tips</h3>
            <div id="safety-tips">
                <!-- Safety tips will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // =================================
        // CONFIGURATION CONSTANTS
        // =================================
        
        // API Configuration
        const CONFIG = {
            AI: {
                API_KEY: 'AIzaSyCTvaHSOhBtsLlfA0GPCFBa2kJnReoh4FI',
                API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent',
                // Alternative CORS proxy for local development
                PROXY_URL: 'https://api.allorigins.win/raw?url=',
                MAX_OUTPUT_TOKENS: 4000,
                TEMPERATURE: 0.7,
                CANDIDATE_COUNT: 1
            },
            MAPS: {
                DEFAULT_ZOOM: 15,
                WORLD_ZOOM: 2,
                EMBED_BASE_URL: 'https://www.google.com/maps',
                SEARCH_PARAMS: '?q={query}&output=embed',
                LOCATION_PARAMS: '?q={lat},{lng}&output=embed&zoom={zoom}',
                WORLD_VIEW: '?q=world&output=embed&zoom=2'
            },
            UI: {
                LOADING_DELAY: 3000,
                SUGGESTION_MIN_LENGTH: 2,
                MAX_SUGGESTIONS: 8,
                SUGGESTION_DEBOUNCE: 300
            },
            BUDGET_RANGES: {
                budget: {
                    activity: { min: 15, max: 25 },
                    meal: { min: 8, max: 15 },
                    transport: { min: 5, max: 10 }
                },
                'mid-range': {
                    activity: { min: 30, max: 50 },
                    meal: { min: 20, max: 35 },
                    transport: { min: 10, max: 20 }
                },
                luxury: {
                    activity: { min: 60, max: 100 },
                    meal: { min: 45, max: 70 },
                    transport: { min: 25, max: 40 }
                }
            },
            // Development environment detection
            ENVIRONMENT: {
                isDevelopment: window.location.hostname === 'localhost' || 
                              window.location.hostname === '127.0.0.1' ||
                              window.location.hostname === '',
                isProduction: window.location.protocol === 'https:'
            }
        };

        // Comprehensive World Destinations Database
        const DESTINATIONS_DATABASE = {
            // North America
            'United States': [
                'New York City, NY', 'Los Angeles, CA', 'Chicago, IL', 'Houston, TX', 'Phoenix, AZ',
                'Philadelphia, PA', 'San Antonio, TX', 'San Diego, CA', 'Dallas, TX', 'San Jose, CA',
                'Austin, TX', 'Jacksonville, FL', 'Fort Worth, TX', 'Columbus, OH', 'San Francisco, CA',
                'Charlotte, NC', 'Indianapolis, IN', 'Seattle, WA', 'Denver, CO', 'Washington, DC',
                'Boston, MA', 'El Paso, TX', 'Detroit, MI', 'Nashville, TN', 'Portland, OR',
                'Memphis, TN', 'Oklahoma City, OK', 'Las Vegas, NV', 'Louisville, KY', 'Baltimore, MD',
                'Milwaukee, WI', 'Albuquerque, NM', 'Tucson, AZ', 'Fresno, CA', 'Mesa, AZ',
                'Sacramento, CA', 'Atlanta, GA', 'Kansas City, MO', 'Colorado Springs, CO', 'Miami, FL',
                'Raleigh, NC', 'Omaha, NE', 'Long Beach, CA', 'Virginia Beach, VA', 'Oakland, CA'
            ],
            'Canada': [
                'Toronto, ON', 'Montreal, QC', 'Vancouver, BC', 'Calgary, AB', 'Edmonton, AB',
                'Ottawa, ON', 'Winnipeg, MB', 'Quebec City, QC', 'Hamilton, ON', 'Kitchener, ON',
                'London, ON', 'Victoria, BC', 'Halifax, NS', 'Oshawa, ON', 'Windsor, ON'
            ],
            'Mexico': [
                'Mexico City', 'Guadalajara', 'Monterrey', 'Puebla', 'Tijuana', 'León', 'Juárez',
                'Torreón', 'Querétaro', 'San Luis Potosí', 'Mérida', 'Mexicali', 'Aguascalientes',
                'Cancún', 'Playa del Carmen', 'Puerto Vallarta', 'Acapulco', 'Mazatlán'
            ],

            // Europe
            'United Kingdom': [
                'London', 'Birmingham', 'Manchester', 'Glasgow', 'Liverpool', 'Leeds', 'Sheffield',
                'Edinburgh', 'Bristol', 'Cardiff', 'Leicester', 'Coventry', 'Bradford', 'Belfast',
                'Nottingham', 'Hull', 'Newcastle', 'Stoke-on-Trent', 'Southampton', 'Derby'
            ],
            'France': [
                'Paris', 'Marseille', 'Lyon', 'Toulouse', 'Nice', 'Nantes', 'Strasbourg', 'Montpellier',
                'Bordeaux', 'Lille', 'Rennes', 'Reims', 'Le Havre', 'Saint-Étienne', 'Toulon',
                'Grenoble', 'Dijon', 'Angers', 'Nîmes', 'Villeurbanne', 'Cannes', 'Avignon'
            ],
            'Germany': [
                'Berlin', 'Hamburg', 'Munich', 'Cologne', 'Frankfurt', 'Stuttgart', 'Düsseldorf',
                'Dortmund', 'Essen', 'Leipzig', 'Bremen', 'Dresden', 'Hanover', 'Nuremberg',
                'Duisburg', 'Bochum', 'Wuppertal', 'Bielefeld', 'Bonn', 'Münster'
            ],
            'Italy': [
                'Rome', 'Milan', 'Naples', 'Turin', 'Palermo', 'Genoa', 'Bologna', 'Florence',
                'Bari', 'Catania', 'Venice', 'Verona', 'Messina', 'Padua', 'Trieste', 'Taranto',
                'Brescia', 'Prato', 'Parma', 'Modena', 'Amalfi', 'Positano', 'Cinque Terre'
            ],
            'Spain': [
                'Madrid', 'Barcelona', 'Valencia', 'Seville', 'Zaragoza', 'Málaga', 'Murcia',
                'Palma', 'Las Palmas', 'Bilbao', 'Alicante', 'Córdoba', 'Valladolid', 'Vigo',
                'Gijón', 'Granada', 'San Sebastian', 'Toledo', 'Salamanca', 'Segovia'
            ],
            'Netherlands': [
                'Amsterdam', 'Rotterdam', 'The Hague', 'Utrecht', 'Eindhoven', 'Tilburg',
                'Groningen', 'Almere', 'Breda', 'Nijmegen', 'Haarlem', 'Arnhem', 'Zaanstad',
                'Haarlemmermeer', 'Apeldoorn', 'Maastricht', 'Delft', 'Leiden'
            ],

            // Asia
            'Japan': [
                'Tokyo', 'Yokohama', 'Osaka', 'Nagoya', 'Sapporo', 'Fukuoka', 'Kobe', 'Kawasaki',
                'Kyoto', 'Saitama', 'Hiroshima', 'Sendai', 'Kitakyushu', 'Chiba', 'Sakai',
                'Niigata', 'Hamamatsu', 'Kumamoto', 'Sagamihara', 'Shizuoka', 'Nara', 'Nikko'
            ],
            'China': [
                'Beijing', 'Shanghai', 'Guangzhou', 'Shenzhen', 'Tianjin', 'Wuhan', 'Dongguan',
                'Chengdu', 'Nanjing', 'Chongqing', 'Xi\'an', 'Suzhou', 'Harbin', 'Hangzhou',
                'Qingdao', 'Dalian', 'Zhengzhou', 'Jinan', 'Kunming', 'Changsha'
            ],
            'India': [
                'Mumbai', 'Delhi', 'Bangalore', 'Hyderabad', 'Ahmedabad', 'Chennai', 'Kolkata',
                'Surat', 'Pune', 'Jaipur', 'Lucknow', 'Kanpur', 'Nagpur', 'Indore', 'Thane',
                'Bhopal', 'Visakhapatnam', 'Pimpri-Chinchwad', 'Patna', 'Vadodara', 'Goa',
                'Agra', 'Varanasi', 'Udaipur', 'Rishikesh', 'Manali', 'Shimla'
            ],
            'Thailand': [
                'Bangkok', 'Nonthaburi', 'Pak Kret', 'Hat Yai', 'Chiang Mai', 'Phuket',
                'Pattaya', 'Udon Thani', 'Surat Thani', 'Khon Kaen', 'Krabi', 'Koh Samui',
                'Ayutthaya', 'Hua Hin', 'Kanchanaburi', 'Sukhothai'
            ],
            'Singapore': ['Singapore'],
            'South Korea': [
                'Seoul', 'Busan', 'Incheon', 'Daegu', 'Daejeon', 'Gwangju', 'Suwon', 'Ulsan',
                'Changwon', 'Goyang', 'Yongin', 'Seongnam', 'Bucheon', 'Cheongju', 'Ansan'
            ],

            // Oceania
            'Australia': [
                'Sydney', 'Melbourne', 'Brisbane', 'Perth', 'Adelaide', 'Gold Coast', 'Newcastle',
                'Canberra', 'Wollongong', 'Logan City', 'Geelong', 'Hobart', 'Townsville',
                'Cairns', 'Darwin', 'Ballarat', 'Bendigo', 'Albury', 'Launceston'
            ],
            'New Zealand': [
                'Auckland', 'Wellington', 'Christchurch', 'Hamilton', 'Tauranga', 'Dunedin',
                'Palmerston North', 'Hastings', 'Nelson', 'Rotorua', 'New Plymouth', 'Whangarei',
                'Invercargill', 'Whanganui', 'Gisborne', 'Napier', 'Queenstown'
            ],

            // South America
            'Brazil': [
                'São Paulo', 'Rio de Janeiro', 'Brasília', 'Salvador', 'Fortaleza', 'Belo Horizonte',
                'Manaus', 'Curitiba', 'Recife', 'Goiânia', 'Belém', 'Porto Alegre', 'Guarulhos',
                'Campinas', 'São Luís', 'São Gonçalo', 'Maceió', 'Duque de Caxias', 'Natal'
            ],
            'Argentina': [
                'Buenos Aires', 'Córdoba', 'Rosario', 'Mendoza', 'Tucumán', 'La Plata', 'Mar del Plata',
                'Salta', 'Santa Fe', 'San Juan', 'Resistencia', 'Santiago del Estero', 'Corrientes'
            ],

            // Africa
            'South Africa': [
                'Johannesburg', 'Cape Town', 'Durban', 'Pretoria', 'Port Elizabeth', 'Bloemfontein',
                'East London', 'Nelspruit', 'Polokwane', 'Kimberley', 'Rustenburg'
            ],
            'Egypt': [
                'Cairo', 'Alexandria', 'Giza', 'Shubra El Kheima', 'Port Said', 'Suez', 'Luxor',
                'Mansoura', 'El Mahalla El Kubra', 'Tanta', 'Asyut', 'Ismailia', 'Aswan'
            ],

            // Middle East
            'United Arab Emirates': [
                'Dubai', 'Abu Dhabi', 'Sharjah', 'Al Ain', 'Ajman', 'Ras Al Khaimah',
                'Fujairah', 'Umm Al Quwain', 'Khor Fakkan', 'Kalba'
            ],
            'Turkey': [
                'Istanbul', 'Ankara', 'Izmir', 'Bursa', 'Adana', 'Gaziantep', 'Konya', 'Antalya',
                'Kayseri', 'Mersin', 'Eskişehir', 'Diyarbakır', 'Samsun', 'Denizli', 'Şanlıurfa',
                'Adapazarı', 'Malatya', 'Kahramanmaraş', 'Erzurum', 'Van', 'Cappadocia', 'Pamukkale'
            ]
        };

        // Flatten destinations for search
        const ALL_DESTINATIONS = Object.entries(DESTINATIONS_DATABASE)
            .flatMap(([country, cities]) => 
                cities.map(city => `${city}, ${country}`)
            );

        // Activity and Interest Constants
        const INTERESTS = {
            HISTORY: 'history',
            ART: 'art', 
            FOOD: 'food',
            NATURE: 'nature',
            NIGHTLIFE: 'nightlife',
            SHOPPING: 'shopping',
            ADVENTURE: 'adventure',
            WELLNESS: 'wellness',
            CULTURE: 'culture',
            PHOTOGRAPHY: 'photography'
        };

        const BUDGET_TYPES = {
            BUDGET: 'budget',
            MID_RANGE: 'mid-range',
            LUXURY: 'luxury'
        };

        const ACCOMMODATION_TYPES = {
            HOTEL: 'hotel',
            HOSTEL: 'hostel',
            AIRBNB: 'airbnb',
            RESORT: 'resort'
        };

        const TRANSPORTATION_TYPES = {
            FLIGHT: 'flight',
            TRAIN: 'train',
            BUS: 'bus',
            CAR: 'car'
        };

        // Status Message Types
        const MESSAGE_TYPES = {
            SUCCESS: 'success',
            ERROR: 'error', 
            INFO: 'info',
            WARNING: 'warning'
        };

        // =================================
        // GLOBAL VARIABLES
        // =================================
        let userLocation;
        let placesService;
        let autocompleteService;
        let searchTimeout;        // Simple map functions that work with embedded map
        function searchLocation() {
            const searchInput = document.getElementById('map-search');
            const query = searchInput.value.trim();
            
            if (!query) {
                showStatusMessage('Please enter a location to search', MESSAGE_TYPES.ERROR);
                return;
            }
            
            // Update embedded map with search query using configuration
            const encodedQuery = encodeURIComponent(query);
            const mapIframe = document.getElementById('map-iframe');
            
            if (mapIframe) {
                const mapUrl = CONFIG.MAPS.EMBED_BASE_URL + 
                             CONFIG.MAPS.SEARCH_PARAMS.replace('{query}', encodedQuery);
                mapIframe.src = mapUrl;
                showStatusMessage(`Showing location: ${query}`, MESSAGE_TYPES.SUCCESS);
            }
        }
        
        function showUserLocation() {
            if (navigator.geolocation) {
                showStatusMessage('Getting your location...', MESSAGE_TYPES.INFO);
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        const mapIframe = document.getElementById('map-iframe');
                        if (mapIframe) {
                            const mapUrl = CONFIG.MAPS.EMBED_BASE_URL + 
                                         CONFIG.MAPS.LOCATION_PARAMS
                                         .replace('{lat}', lat)
                                         .replace('{lng}', lng)
                                         .replace('{zoom}', CONFIG.MAPS.DEFAULT_ZOOM);
                            mapIframe.src = mapUrl;
                            showStatusMessage('Showing your current location', MESSAGE_TYPES.SUCCESS);
                        }
                    },
                    (error) => {
                        showStatusMessage('Unable to get your location. Please check location permissions.', MESSAGE_TYPES.ERROR);
                        console.error('Geolocation error:', error);
                    }
                );
            } else {
                showStatusMessage('Geolocation is not supported by this browser', MESSAGE_TYPES.ERROR);
            }
        }
        
        function resetMap() {
            const mapIframe = document.getElementById('map-iframe');
            const searchInput = document.getElementById('map-search');
            
            if (mapIframe) {
                // Reset to world view using configuration
                mapIframe.src = CONFIG.MAPS.EMBED_BASE_URL + CONFIG.MAPS.WORLD_VIEW;
            }
            if (searchInput) {
                searchInput.value = '';
            }
            showStatusMessage('Map reset to world view', MESSAGE_TYPES.INFO);
        }
        
        // Handle Enter key in search input
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('map-search');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchLocation();
                    }
                });
            }
        });

        // Enhanced destination autocomplete with comprehensive database
        function setupDestinationAutocomplete() {
            const destinationInput = document.getElementById('destination');
            const suggestionsDiv = document.getElementById('destination-suggestions');
            
            if (!destinationInput || !suggestionsDiv) {
                console.log('Autocomplete elements not found, using basic setup');
                return;
            }

            console.log(`Autocomplete database loaded with ${ALL_DESTINATIONS.length} destinations`);

            destinationInput.addEventListener('input', function() {
                const value = this.value.toLowerCase().trim();
                
                // Clear previous timeout
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }
                
                if (value.length < CONFIG.UI.SUGGESTION_MIN_LENGTH) {
                    suggestionsDiv.style.display = 'none';
                    return;
                }

                // Debounce search
                searchTimeout = setTimeout(() => {
                    const suggestions = findDestinationSuggestions(value);
                    
                    if (suggestions.length > 0) {
                        displayDestinationSuggestions(suggestions, suggestionsDiv, destinationInput);
                    } else {
                        suggestionsDiv.style.display = 'none';
                    }
                }, CONFIG.UI.SUGGESTION_DEBOUNCE);
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!destinationInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });

            // Handle keyboard navigation
            destinationInput.addEventListener('keydown', function(e) {
                const suggestions = suggestionsDiv.querySelectorAll('.suggestion-item');
                let activeIndex = Array.from(suggestions).findIndex(item => 
                    item.classList.contains('active')
                );

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    activeIndex = (activeIndex + 1) % suggestions.length;
                    updateActiveSuggestion(suggestions, activeIndex);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    activeIndex = activeIndex <= 0 ? suggestions.length - 1 : activeIndex - 1;
                    updateActiveSuggestion(suggestions, activeIndex);
                } else if (e.key === 'Enter' && activeIndex >= 0) {
                    e.preventDefault();
                    suggestions[activeIndex].click();
                } else if (e.key === 'Escape') {
                    suggestionsDiv.style.display = 'none';
                }
            });
        }

        function findDestinationSuggestions(searchValue) {
            const suggestions = [];
            const searchLower = searchValue.toLowerCase();
            
            // Priority scoring system
            const scoredSuggestions = ALL_DESTINATIONS.map(destination => {
                const destLower = destination.toLowerCase();
                let score = 0;
                
                // Exact match at start (highest priority)
                if (destLower.startsWith(searchLower)) {
                    score = 1000;
                }
                // Match at start of city name
                else if (destLower.split(',')[0].startsWith(searchLower)) {
                    score = 900;
                }
                // Match at start of any word
                else if (destLower.split(/[\s,]+/).some(word => word.startsWith(searchLower))) {
                    score = 800;
                }
                // Contains the search term
                else if (destLower.includes(searchLower)) {
                    score = 700;
                }
                
                // Boost popular destinations
                const popularDestinations = [
                    'new york', 'paris', 'london', 'tokyo', 'rome', 'barcelona', 
                    'amsterdam', 'berlin', 'sydney', 'dubai', 'singapore', 'bangkok'
                ];
                if (popularDestinations.some(pop => destLower.includes(pop))) {
                    score += 100;
                }
                
                return { destination, score };
            })
            .filter(item => item.score > 0)
            .sort((a, b) => b.score - a.score)
            .slice(0, CONFIG.UI.MAX_SUGGESTIONS)
            .map(item => item.destination);
            
            return scoredSuggestions;
        }

        function displayDestinationSuggestions(suggestions, container, inputElement) {
            container.innerHTML = '';
            container.style.display = 'block';

            suggestions.forEach((suggestion, index) => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                
                // Highlight matching text
                const searchValue = inputElement.value.toLowerCase();
                const suggestionText = suggestion;
                const highlightedText = highlightSearchTerm(suggestionText, searchValue);
                
                item.innerHTML = highlightedText;
                
                item.addEventListener('click', () => {
                    inputElement.value = suggestion;
                    container.style.display = 'none';
                    
                    // Update map to show selected destination
                    updateMapForDestination(suggestion);
                    showStatusMessage(`Selected destination: ${suggestion}`, MESSAGE_TYPES.SUCCESS);
                });
                
                item.addEventListener('mouseenter', () => {
                    updateActiveSuggestion(container.querySelectorAll('.suggestion-item'), index);
                });
                
                container.appendChild(item);
            });
        }

        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<strong>$1</strong>');
        }

        function updateActiveSuggestion(suggestions, activeIndex) {
            suggestions.forEach((item, index) => {
                item.classList.toggle('active', index === activeIndex);
            });
        }

        function updateMapForDestination(destination) {
            const encodedDestination = encodeURIComponent(destination);
            const mapIframe = document.getElementById('map-iframe');
            
            if (mapIframe) {
                const mapUrl = CONFIG.MAPS.EMBED_BASE_URL + 
                             CONFIG.MAPS.SEARCH_PARAMS.replace('{query}', encodedDestination);
                mapIframe.src = mapUrl;
                showStatusMessage(`Map updated to show ${destination}`, MESSAGE_TYPES.SUCCESS);
            }
        }

        // Initialize autocomplete when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setupDestinationAutocomplete();
        });

        // Status message helper function
        function showStatusMessage(message, type = 'info') {
            const statusDiv = document.getElementById('status-messages');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = `<div style="color: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#007bff'}; font-weight: bold;">${message}</div>`;
            
            // Auto-hide after 5 seconds unless it's an error
            if (type !== 'error') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // AI-Powered Itinerary Generation with Enhanced Intelligence
        async function generateItineraryWithAI() {
            const form = document.getElementById('itinerary-form');
            const formData = new FormData(form);
            const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked')).map(cb => cb.value);
            
            const destination = formData.get('destination');
            const startDate = formData.get('start-date');
            const endDate = formData.get('end-date');
            const budget = formData.get('budget');
            const accommodation = formData.get('accommodation');
            const transportation = formData.get('transportation');
            const groupSize = formData.get('group-size');
            const dietary = formData.get('dietary');

            if (!destination || !startDate || !endDate) {
                showStatusMessage('Please fill in all required fields (destination, start date, end date)', 'error');
                return;
            }

            // Validate destination is a real place
            const cleanDestination = destination.toLowerCase().trim();
            if (cleanDestination.includes('test') || cleanDestination.includes('haha') || cleanDestination.includes('doesnt') || cleanDestination.length < 3) {
                showStatusMessage('Please enter a real destination (e.g., Paris, Tokyo, New York)', 'error');
                return;
            }

            // Show loading and status
            showStatusMessage('Starting AI itinerary generation...', 'info');
            document.getElementById('loading').style.display = 'block';
            document.getElementById('itinerary-results').style.display = 'none';

            try {
                // Calculate trip duration and season
                const start = new Date(startDate);
                const end = new Date(endDate);
                const duration = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                const month = start.toLocaleDateString('en-US', { month: 'long' });
                const season = getSeason(start.getMonth());

                // Enhanced AI prompt with more context and intelligence
                const prompt = `Create a ${duration}-day travel itinerary for ${destination} from ${startDate} to ${endDate} for ${groupSize} people with a ${budget} budget. Interests: ${interests.join(', ') || 'general sightseeing'}.

RESPOND WITH ONLY A VALID JSON OBJECT IN THIS EXACT FORMAT:

{
  "destination_overview": {
    "climate": "Weather info for ${destination} in ${month}",
    "local_currency": "Currency name and usage tips", 
    "language_basics": ["Hello phrase", "Thank you phrase", "Please phrase"],
    "tipping_customs": "Local tipping practices",
    "best_neighborhoods": ["Real neighborhood 1", "Real neighborhood 2", "Real neighborhood 3"]
  },
  "days": [
    {
      "day": 1,
      "date": "${startDate}",
      "theme": "Arrival & Orientation",
      "activities": [
        {
          "time": "9:00 AM",
          "duration": "3 hours",
          "title": "Real attraction name in ${destination}",
          "location": "Exact neighborhood or area",
          "description": "What you'll do and see",
          "cost": "$XX-XX",
          "insider_tip": "Local tip or secret",
          "backup_option": "Alternative if weather is bad"
        },
        {
          "time": "1:00 PM", 
          "duration": "2 hours",
          "title": "Real restaurant name for lunch",
          "location": "Restaurant area",
          "description": "What to order and why it's special",
          "cost": "$XX-XX",
          "insider_tip": "Best dishes or timing",
          "backup_option": "Alternative dining option"
        },
        {
          "time": "3:30 PM",
          "duration": "3 hours", 
          "title": "Real afternoon activity",
          "location": "Specific area",
          "description": "Activity details",
          "cost": "$XX-XX",
          "insider_tip": "Best approach",
          "backup_option": "Indoor alternative"
        }
      ],
      "cultural_insight": "Interesting cultural fact about ${destination}",
      "photo_opportunities": ["Best photo spot 1", "Best photo spot 2"],
      "safety_tip": "Important safety advice"
    }
  ],
  "practical_information": {
    "budget_breakdown": {
      "activities": "$XX-XX/day",
      "food": "$XX-XX/day", 
      "transportation": "$XX-XX/day",
      "total_estimated": "$XX-XX/day per person"
    },
    "packing_essentials": ["Essential item 1", "Essential item 2", "Essential item 3"],
    "cultural_dos_and_donts": {
      "dos": ["Do this respectful thing", "Do this cultural practice"],
      "donts": ["Avoid this behavior", "Don't do this mistake"]
    }
  },
  "hidden_gems": ["Real secret spot 1", "Real hidden gem 2", "Real local favorite 3"],
  "local_events": "Festivals or events during ${month}"
}

IMPORTANT REQUIREMENTS:
- Use REAL places, restaurants, and attractions in ${destination}
- Make it exactly ${duration} days
- Include ${budget} appropriate pricing
- NO fake names or placeholder text
- Return ONLY the JSON object, no other text`;

                // Call Gemini with enhanced prompt and CORS fallback
                showStatusMessage('Connecting to AI service...', MESSAGE_TYPES.INFO);
                console.log('Calling Gemini API with destination:', destination);
                
                let response;
                let usedProxy = false;
                
                try {
                    // First attempt: Direct API call
                    response = await fetch(`${CONFIG.AI.API_URL}?key=${CONFIG.AI.API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Referer': window.location.origin || 'https://localhost'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: CONFIG.AI.TEMPERATURE,
                                maxOutputTokens: CONFIG.AI.MAX_OUTPUT_TOKENS,
                                candidateCount: CONFIG.AI.CANDIDATE_COUNT
                            }
                        })
                    });
                } catch (networkError) {
                    console.log('Direct API call failed, attempting CORS proxy fallback...');
                    showStatusMessage('Using CORS proxy for development environment...', MESSAGE_TYPES.INFO);
                    
                    try {
                        // Fallback: Use CORS proxy for development environment
                        const proxyUrl = CONFIG.AI.PROXY_URL + encodeURIComponent(`${CONFIG.AI.API_URL}?key=${CONFIG.AI.API_KEY}`);
                        response = await fetch(proxyUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: prompt
                                    }]
                                }],
                                generationConfig: {
                                    temperature: CONFIG.AI.TEMPERATURE,
                                    maxOutputTokens: CONFIG.AI.MAX_OUTPUT_TOKENS,
                                    candidateCount: CONFIG.AI.CANDIDATE_COUNT
                                }
                            })
                        });
                        usedProxy = true;
                    } catch (proxyError) {
                        console.error('Both direct and proxy attempts failed:', proxyError);
                        throw new Error('Unable to connect to AI service');
                    }
                }

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Gemini API Error:', response.status, errorText);
                    
                    // Handle specific error cases
                    if (response.status === 403) {
                        try {
                            const errorData = JSON.parse(errorText);
                            if (errorData.error?.message?.includes('blocked') || errorData.error?.message?.includes('referer')) {
                                showStatusMessage('API Error: Referrer blocked. This is a development environment restriction. The API should work in production.', MESSAGE_TYPES.ERROR);
                                console.log('Referrer blocking detected. Attempting CORS proxy fallback...');
                                
                                if (!usedProxy) {
                                    // Try CORS proxy as fallback for referrer restrictions
                                    try {
                                        const proxyUrl = CONFIG.AI.PROXY_URL + encodeURIComponent(`${CONFIG.AI.API_URL}?key=${CONFIG.AI.API_KEY}`);
                                        response = await fetch(proxyUrl, {
                                            method: 'POST',
                                            headers: {
                                                'Content-Type': 'application/json'
                                            },
                                            body: JSON.stringify({
                                                contents: [{
                                                    parts: [{
                                                        text: prompt
                                                    }]
                                                }],
                                                generationConfig: {
                                                    temperature: CONFIG.AI.TEMPERATURE,
                                                    maxOutputTokens: CONFIG.AI.MAX_OUTPUT_TOKENS,
                                                    candidateCount: CONFIG.AI.CANDIDATE_COUNT
                                                }
                                            })
                                        });
                                        
                                        if (!response.ok) {
                                            throw new Error('CORS proxy also failed');
                                        }
                                        
                                        showStatusMessage('Connected using CORS proxy workaround', MESSAGE_TYPES.INFO);
                                    } catch (corsError) {
                                        throw new Error('API_REFERRER_BLOCKED_FINAL');
                                    }
                                } else {
                                    throw new Error('API_REFERRER_BLOCKED_FINAL');
                                }
                            }
                        } catch (parseError) {
                            // If we can't parse the error, treat it as a general 403
                            console.error('Could not parse 403 error response');
                        }
                    }
                    
                    if (!response.ok) {
                        throw new Error(`AI service error: ${response.status} - ${errorText.substring(0, 200)}...`);
                    }
                }

                const data = await response.json();
                console.log('Gemini API Response:', data);

                // Parse Gemini response
                if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
                    try {
                        showStatusMessage('Processing AI response...', 'info');
                        // Improved JSON parsing with multiple attempts
                        const itineraryText = data.candidates[0].content.parts[0].text;
                        console.log('Raw AI response:', itineraryText);
                        
                        let jsonString = '';
                        let itinerary = null;
                        
                        // Try different JSON extraction methods
                        try {
                            // Method 1: Look for complete JSON object
                            const jsonStart = itineraryText.indexOf('{');
                            const jsonEnd = itineraryText.lastIndexOf('}') + 1;
                            
                            if (jsonStart !== -1 && jsonEnd > jsonStart) {
                                jsonString = itineraryText.substring(jsonStart, jsonEnd);
                                console.log('Extracted JSON (Method 1):', jsonString);
                                itinerary = JSON.parse(jsonString);
                            } else {
                                throw new Error('No complete JSON object found');
                            }
                        } catch (firstAttempt) {
                            console.log('First parsing attempt failed, trying method 2');
                            
                            try {
                                // Method 2: Try to find JSON between ```json blocks
                                const jsonMatch = itineraryText.match(/```json\s*([\s\S]*?)\s*```/);
                                if (jsonMatch) {
                                    jsonString = jsonMatch[1];
                                    console.log('Extracted JSON (Method 2):', jsonString);
                                    itinerary = JSON.parse(jsonString);
                                } else {
                                    throw new Error('No JSON blocks found');
                                }
                            } catch (secondAttempt) {
                                console.log('Second parsing attempt failed, trying method 3');
                                
                                try {
                                    // Method 3: Try to parse the entire response as JSON
                                    itinerary = JSON.parse(itineraryText.trim());
                                    console.log('Parsed entire response as JSON (Method 3)');
                                } catch (thirdAttempt) {
                                    console.error('All JSON parsing attempts failed');
                                    console.log('First attempt error:', firstAttempt.message);
                                    console.log('Second attempt error:', secondAttempt.message);
                                    console.log('Third attempt error:', thirdAttempt.message);
                                    throw new Error('Could not parse AI response as JSON');
                                }
                            }
                        }
                        
                        if (itinerary) {
                            showStatusMessage('AI itinerary generated successfully!', 'success');
                            displayEnhancedAIItinerary(itinerary);
                        } else {
                            throw new Error('Failed to extract valid itinerary data');
                        }
                    } catch (parseError) {
                        console.error('AI response parsing failed:', parseError);
                        console.log('Raw response text:', data.candidates[0].content.parts[0].text);
                        showStatusMessage('AI response format error. Generating fallback itinerary...', 'error');
                        generateFallbackItinerary(destination, startDate, endDate, interests, budget, groupSize);
                    }
                } else {
                    console.error('Invalid Gemini response structure:', data);
                    throw new Error('Invalid AI response format');
                }
            } catch (error) {
                console.error('AI Generation failed:', error);
                
                if (error.message === 'API_REFERRER_BLOCKED_FINAL') {
                    showStatusMessage('⚠️ API Error: Referrer blocked. This is a development environment restriction. The API should work in production. Using fallback itinerary...', MESSAGE_TYPES.ERROR);
                } else if (error.message.includes('referrer') || error.message.includes('blocked')) {
                    showStatusMessage('🔒 Development environment detected. API restrictions active. Using fallback itinerary...', MESSAGE_TYPES.WARNING);
                } else {
                    showStatusMessage('AI service is currently unavailable. Generating fallback itinerary...', MESSAGE_TYPES.ERROR);
                }
                
                generateFallbackItinerary(destination, startDate, endDate, interests, budget, groupSize);
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('itinerary-results').style.display = 'block';
        }

        // Create a fallback itinerary when AI fails
        function generateFallbackItinerary(destination, startDate, endDate, interests, budget, groupSize) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const duration = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            
            // Destination-specific data
            const destinationData = getDestinationData(destination);
            
            const fallbackItinerary = {
                destination_overview: {
                    climate: destinationData.climate || `Weather information for ${destination} in ${start.toLocaleDateString('en-US', { month: 'long' })}`,
                    culture_highlights: destinationData.culture_highlights || [`Local culture of ${destination}`, "Traditional customs and practices"],
                    local_currency: destinationData.currency || "Local currency information",
                    language_basics: destinationData.language_basics || ["Hello", "Thank you", "Please"],
                    tipping_customs: destinationData.tipping || "Standard tipping practices",
                    best_neighborhoods: destinationData.neighborhoods || [`Central ${destination}`, `Historic district of ${destination}`]
                },
                days: []
            };

            // Generate days based on interests and preferences
            for (let i = 0; i < duration; i++) {
                const currentDate = new Date(start);
                currentDate.setDate(start.getDate() + i);
                
                const dayActivities = [];
                const selectedInterests = interests.length > 0 ? interests : ['food', 'history', 'nature'];
                
                // Morning activity based on interests
                const morningInterest = selectedInterests[i % selectedInterests.length];
                const morningActivity = getActivityByInterest(morningInterest, destination);
                dayActivities.push({
                    time: "9:00 AM",
                    duration: "3 hours",
                    title: morningActivity,
                    location: getActivityLocation(morningActivity, destination),
                    description: getActivityDescription(morningActivity, morningInterest, destination),
                    cost: getBudgetCost(budget, 'activity'),
                    insider_tip: getInsiderTip(morningInterest, destination),
                    backup_option: getBackupOption(morningInterest)
                });
                
                // Lunch
                const lunchPlace = getLocalRestaurant(destination, budget);
                dayActivities.push({
                    time: "12:30 PM",
                    duration: "1.5 hours",
                    title: lunchPlace.name,
                    location: lunchPlace.location,
                    description: lunchPlace.description,
                    cost: getBudgetCost(budget, 'meal'),
                    insider_tip: lunchPlace.tip,
                    backup_option: lunchPlace.backup
                });
                
                // Afternoon activity
                const afternoonInterest = selectedInterests[(i + 1) % selectedInterests.length];
                const afternoonActivity = getActivityByInterest(afternoonInterest, destination);
                dayActivities.push({
                    time: "2:30 PM",
                    duration: "3 hours",
                    title: afternoonActivity,
                    location: getActivityLocation(afternoonActivity, destination),
                    description: getActivityDescription(afternoonActivity, afternoonInterest, destination),
                    cost: getBudgetCost(budget, 'activity'),
                    insider_tip: getInsiderTip(afternoonInterest, destination),
                    backup_option: getBackupOption(afternoonInterest)
                });

                fallbackItinerary.days.push({
                    day: i + 1,
                    date: currentDate.toLocaleDateString(),
                    theme: getDayTheme(i, duration, selectedInterests),
                    weather_note: getWeatherNote(destination, currentDate),
                    activities: dayActivities,
                    meals: getMealRecommendations(destination, budget),
                    cultural_insight: getCulturalInsight(destination, i),
                    photo_opportunities: getPhotoOpportunities(destination, selectedInterests[i % selectedInterests.length])
                });
            }

            fallbackItinerary.practical_information = getPracticalInfo(destination, budget, duration, groupSize);
            fallbackItinerary.hidden_gems = getHiddenGems(destination);
            fallbackItinerary.local_events = getLocalEvents(destination, start);

            displayEnhancedAIItinerary(fallbackItinerary);
        }

        function getActivityByInterest(interest, destination) {
            // Destination-specific activity mappings
            const destinationActivities = {
                'paris': {
                    history: 'Louvre Museum & Palace of Versailles',
                    art: 'Musée d\'Orsay & Montmartre Artists Quarter',
                    food: 'French Pastry Workshop & Wine Tasting',
                    nature: 'Luxembourg Gardens & Seine River Walk',
                    nightlife: 'Champs-Élysées & Latin Quarter Evening',
                    culture: 'Notre-Dame & Sainte-Chapelle'
                },
                'tokyo': {
                    history: 'Imperial Palace & Senso-ji Temple',
                    art: 'Tokyo National Museum & TeamLab Digital Art',
                    food: 'Tsukiji Fish Market & Sushi Making Class',
                    nature: 'Ueno Park & East Gardens',
                    nightlife: 'Shibuya & Golden Gai Districts',
                    culture: 'Traditional Tea Ceremony & Kabuki Theatre'
                },
                'london': {
                    history: 'Tower of London & Westminster Abbey',
                    art: 'Tate Modern & National Gallery',
                    food: 'Borough Market & Afternoon Tea Experience',
                    nature: 'Hyde Park & Regent\'s Park',
                    nightlife: 'Covent Garden & Soho District',
                    culture: 'British Museum & Globe Theatre'
                },
                'rome': {
                    history: 'Colosseum & Roman Forum',
                    art: 'Vatican Museums & Sistine Chapel',
                    food: 'Pasta Making Class & Trastevere Food Tour',
                    nature: 'Villa Borghese & Appian Way',
                    nightlife: 'Campo de\' Fiori & Testaccio District',
                    culture: 'St. Peter\'s Basilica & Pantheon'
                },
                'new york': {
                    history: 'Statue of Liberty & Ellis Island',
                    art: 'Metropolitan Museum & MoMA',
                    food: 'Chelsea Market & Brooklyn Food Scene',
                    nature: 'Central Park & High Line',
                    nightlife: 'Times Square & Greenwich Village',
                    culture: 'Broadway Show & 9/11 Memorial'
                }
            };

            // Generic activities as fallback
            const genericActivities = {
                history: `${destination} Historical District Tour`,
                art: `${destination} Art & Culture Walk`,
                food: `Local ${destination} Culinary Experience`,
                nature: `${destination} Parks & Natural Areas`,
                nightlife: `${destination} Evening Entertainment`,
                shopping: `${destination} Local Markets & Shops`,
                adventure: `${destination} Outdoor Activities`,
                wellness: `${destination} Relaxation & Wellness`,
                culture: `${destination} Cultural Heritage Tour`,
                photography: `${destination} Photography Experience`
            };

            const destinationKey = destination.toLowerCase().replace(/\s+/g, '');
            const specific = destinationActivities[destinationKey];
            
            if (specific && specific[interest]) {
                return specific[interest];
            }
            
            return genericActivities[interest] || `${destination} Cultural Experience`;
        }

        // Helper function to determine season
        function getSeason(month) {
            if (month >= 11 || month <= 1) return 'Winter';
            if (month >= 2 && month <= 4) return 'Spring';
            if (month >= 5 && month <= 7) return 'Summer';
            return 'Fall';
        }

        // Destination-specific data
        function getDestinationData(destination) {
            const destinationKey = destination.toLowerCase().replace(/\s+/g, '');
            
            const destinations = {
                'paris': {
                    climate: 'Mild and temperate with distinct seasons. Pack layers and an umbrella.',
                    currency: 'Euro (€) - Cards widely accepted',
                    language_basics: ['Bonjour (Hello)', 'Merci (Thank you)', 'S\'il vous plaît (Please)', 'Excusez-moi (Excuse me)'],
                    tipping: '5-10% at restaurants, round up for taxis',
                    neighborhoods: ['Le Marais', 'Saint-Germain', 'Montmartre', 'Latin Quarter'],
                    culture_highlights: ['Café culture', 'Art and fashion', 'Culinary excellence', 'Historical architecture']
                },
                'tokyo': {
                    climate: 'Humid subtropical with hot summers and mild winters. Rainy season in June-July.',
                    currency: 'Japanese Yen (¥) - Cash preferred, cards increasingly accepted',
                    language_basics: ['Konnichiwa (Hello)', 'Arigatou gozaimasu (Thank you)', 'Sumimasen (Excuse me)', 'Onegaishimasu (Please)'],
                    tipping: 'No tipping culture - excellent service is standard',
                    neighborhoods: ['Shibuya', 'Harajuku', 'Asakusa', 'Ginza', 'Shinjuku'],
                    culture_highlights: ['Respect and politeness', 'Traditional ceremonies', 'Modern technology', 'Seasonal celebrations']
                },
                'london': {
                    climate: 'Temperate oceanic with mild summers and cool winters. Always pack an umbrella!',
                    currency: 'British Pound (£) - Contactless payments widely used',
                    language_basics: ['Hello', 'Cheers (Thank you/Goodbye)', 'Please', 'Sorry'],
                    tipping: '10-15% at restaurants if service charge not included',
                    neighborhoods: ['Covent Garden', 'Shoreditch', 'Notting Hill', 'Borough', 'Camden'],
                    culture_highlights: ['Pub culture', 'Royal heritage', 'Afternoon tea', 'Multicultural diversity']
                },
                'rome': {
                    climate: 'Mediterranean with hot, dry summers and mild winters. Peak heat in July-August.',
                    currency: 'Euro (€) - Cash still important for small vendors',
                    language_basics: ['Ciao (Hello/Goodbye)', 'Grazie (Thank you)', 'Per favore (Please)', 'Scusi (Excuse me)'],
                    tipping: 'Round up or 5-10% at restaurants, €1-2 for hotel services',
                    neighborhoods: ['Trastevere', 'Centro Storico', 'Testaccio', 'Monti'],
                    culture_highlights: ['Ancient history', 'Catholic traditions', 'Aperitivo culture', 'Art and architecture']
                },
                'newyork': {
                    climate: 'Continental with hot summers and cold winters. Layers essential year-round.',
                    currency: 'US Dollar ($) - Cards accepted everywhere, Apple Pay/Google Pay common',
                    language_basics: ['Hey/Hello', 'Thanks', 'Please', 'Excuse me'],
                    tipping: '18-22% at restaurants, $1-2 per drink at bars, 15-20% for taxis',
                    neighborhoods: ['Greenwich Village', 'SoHo', 'Williamsburg', 'Lower East Side', 'Chelsea'],
                    culture_highlights: ['Melting pot culture', 'Fast-paced lifestyle', 'Arts and entertainment', 'Food diversity']
                }
            };

            return destinations[destinationKey] || {
                climate: `Check local weather for ${destination}`,
                currency: 'Local currency',
                language_basics: ['Hello', 'Thank you', 'Please'],
                tipping: 'Research local tipping customs',
                neighborhoods: [`Central ${destination}`, `Historic ${destination}`],
                culture_highlights: [`Local culture of ${destination}`]
            };
        }

        function getBudgetCost(budget, type) {
            const budgetConfig = CONFIG.BUDGET_RANGES[budget];
            if (!budgetConfig || !budgetConfig[type]) {
                return '$20-40'; // Default fallback
            }
            
            const range = budgetConfig[type];
            return `$${range.min}-${range.max}`;
        }

        function getActivityLocation(activity, destination) {
            if (activity.includes('Museum') || activity.includes('Gallery')) {
                return `${destination} Cultural District`;
            } else if (activity.includes('Market') || activity.includes('Food')) {
                return `${destination} Food Quarter`;
            } else if (activity.includes('Park') || activity.includes('Garden')) {
                return `${destination} Green Spaces`;
            } else if (activity.includes('Temple') || activity.includes('Church')) {
                return `${destination} Historic Center`;
            }
            return `${destination} City Center`;
        }

        function getActivityDescription(activity, interest, destination) {
            const descriptions = {
                history: `Immerse yourself in ${destination}'s rich historical heritage through this carefully curated experience.`,
                art: `Discover the vibrant art scene and creative spirit that defines ${destination}.`,
                food: `Savor the authentic flavors and culinary traditions that make ${destination} unique.`,
                nature: `Experience the natural beauty and peaceful spaces within ${destination}.`,
                culture: `Connect with the local culture and traditions of ${destination}.`,
                nightlife: `Experience the energy and excitement of ${destination} after dark.`
            };
            return descriptions[interest] || `Explore the best of what ${destination} has to offer.`;
        }

        function getInsiderTip(interest, destination) {
            const tips = {
                history: `Visit early morning for fewer crowds and better photos.`,
                art: `Many galleries offer free admission on certain days - check schedules.`,
                food: `Ask locals for their favorite spots - they know the hidden gems.`,
                nature: `Best lighting for photos is during golden hour (sunrise/sunset).`,
                culture: `Engage with locals - most are happy to share their culture.`,
                nightlife: `Pre-game with locals to learn the best spots and safety tips.`
            };
            return tips[interest] || `Connect with locals for authentic recommendations.`;
        }

        function getBackupOption(interest) {
            const backups = {
                history: `Indoor museums available during inclement weather.`,
                art: `Virtual gallery tours and indoor exhibitions.`,
                food: `Covered markets and indoor dining options.`,
                nature: `Conservatories and indoor gardens available.`,
                culture: `Cultural centers and indoor performances.`,
                nightlife: `Indoor venues and cultural evening events.`
            };
            return backups[interest] || `Indoor alternatives available.`;
        }

        function getLocalRestaurant(destination, budget) {
            const budgetTypes = {
                'budget': 'Local café',
                'mid-range': 'Traditional restaurant',
                'luxury': 'Fine dining establishment'
            };
            
            const type = budgetTypes[budget] || 'Local restaurant';
            
            return {
                name: `Authentic ${destination} Cuisine`,
                location: `${destination} dining district`,
                description: `Experience traditional flavors at this highly-rated ${type}.`,
                tip: `Try the chef's recommendation - it's usually the house specialty.`,
                backup: `Food delivery apps available if weather doesn't cooperate.`
            };
        }

        function getDayTheme(dayIndex, totalDays, interests) {
            if (dayIndex === 0) return "Arrival & Orientation";
            if (dayIndex === totalDays - 1) return "Final Experiences & Departure";
            
            const themes = [
                "Cultural Immersion",
                "Local Exploration", 
                "Hidden Gems",
                "Authentic Experiences",
                "Local Life & Traditions"
            ];
            
            if (interests.length > 0) {
                const interest = interests[dayIndex % interests.length];
                return `${interest.charAt(0).toUpperCase() + interest.slice(1)} Focus`;
            }
            
            return themes[dayIndex % themes.length];
        }

        function getWeatherNote(destination, date) {
            const month = date.getMonth();
            const season = getSeason(month);
            
            const seasonalNotes = {
                'Winter': 'Pack warm clothes and waterproof gear.',
                'Spring': 'Layers recommended - weather can be unpredictable.',
                'Summer': 'Stay hydrated and use sun protection.',
                'Fall': 'Perfect weather for walking - bring light jacket.'
            };
            
            return seasonalNotes[season] || 'Check local weather forecast before outdoor activities.';
        }

        function getMealRecommendations(destination, budget) {
            const levels = {
                'budget': {
                    breakfast: 'Local café with pastries',
                    lunch: 'Street food or casual dining',
                    dinner: 'Traditional local tavern'
                },
                'mid-range': {
                    breakfast: 'Hotel restaurant or upscale café',
                    lunch: 'Recommended local restaurant',
                    dinner: 'Popular dining establishment'
                },
                'luxury': {
                    breakfast: 'Fine dining breakfast experience',
                    lunch: 'Michelin-recommended restaurant',
                    dinner: 'Exclusive culinary experience'
                }
            };
            
            return levels[budget] || levels['mid-range'];
        }

        function getCulturalInsight(destination, dayIndex) {
            const insights = [
                `${destination} is known for its warm hospitality and rich cultural traditions.`,
                `Local customs emphasize respect and community - embrace the slower pace.`,
                `The best way to experience ${destination} is through its people and their stories.`,
                `Each neighborhood in ${destination} has its own unique character and history.`,
                `Traditional festivals and celebrations are integral to ${destination}'s culture.`
            ];
            return insights[dayIndex % insights.length];
        }

        function getPhotoOpportunities(destination, interest) {
            const opportunities = {
                history: ['Historic landmarks', 'Ancient architecture', 'Monument details'],
                art: ['Gallery facades', 'Street art', 'Artist workshops'],
                food: ['Local markets', 'Traditional dishes', 'Cooking processes'],
                nature: ['Scenic viewpoints', 'Garden landscapes', 'Natural textures'],
                culture: ['Local ceremonies', 'Traditional dress', 'Cultural performances'],
                nightlife: ['City lights', 'Evening atmosphere', 'Social gatherings']
            };
            return opportunities[interest] || ['City skyline', 'Street scenes', 'Local life'];
        }

        function getPracticalInfo(destination, budget, duration, groupSize) {
            const dailyCosts = {
                'budget': { activities: 25, food: 20, transport: 10 },
                'mid-range': { activities: 45, food: 35, transport: 20 },
                'luxury': { activities: 80, food: 60, transport: 35 }
            };
            
            const costs = dailyCosts[budget] || dailyCosts['mid-range'];
            const dailyTotal = costs.activities + costs.food + costs.transport;
            const tripTotal = dailyTotal * duration * groupSize;
            
            return {
                budget_breakdown: {
                    activities: `$${costs.activities}-${costs.activities + 20}/day`,
                    food: `$${costs.food}-${costs.food + 15}/day`,
                    transportation: `$${costs.transport}-${costs.transport + 15}/day`,
                    total_estimated: `$${dailyTotal}-${dailyTotal + 50}/day per person`
                },
                packing_essentials: [
                    'Comfortable walking shoes',
                    'Weather-appropriate clothing',
                    'Portable phone charger',
                    'Travel insurance documents',
                    'Local currency or cards',
                    'Camera or smartphone',
                    'Personal medications',
                    'Copies of important documents'
                ],
                cultural_dos_and_donts: {
                    dos: [
                        'Research local customs beforehand',
                        'Learn basic local phrases',
                        'Respect religious and cultural sites',
                        'Support local businesses',
                        'Be open to new experiences'
                    ],
                    donts: [
                        'Don\'t ignore local etiquette',
                        'Don\'t over-schedule your days',
                        'Don\'t forget travel insurance',
                        'Don\'t rely solely on digital maps',
                        'Don\'t dismiss local recommendations'
                    ]
                }
            };
        }

        function getHiddenGems(destination) {
            const destinationKey = destination.toLowerCase().replace(/\s+/g, '');
            
            const gems = {
                'paris': [
                    'Promenade Plantée - elevated park walkway',
                    'Marché des Enfants Rouges - oldest covered market',
                    'Musée de la Chasse et de la Nature - unique hunting museum'
                ],
                'tokyo': [
                    'Todoroki Valley - hidden gorge in the city',
                    'Golden Gai - tiny bars in Shinjuku',
                    'Kanzaki Daishi Temple - peaceful local temple'
                ],
                'london': [
                    'Dennis Severs\' House - immersive historical experience',
                    'Leadenhall Market - Victorian covered market',
                    'God\'s Own Junkyard - neon sign museum'
                ],
                'rome': [
                    'Quartiere Coppedè - Art Nouveau neighborhood',
                    'Centrale Montemartini - ancient statues in power plant',
                    'Via Margutta - charming artisan street'
                ],
                'newyork': [
                    'The High Line - elevated park on old railway',
                    'Green-Wood Cemetery - historic cemetery with views',
                    'Tenement Museum - immigrant history experience'
                ]
            };
            
            return gems[destinationKey] || [
                `Hidden local market in ${destination}`,
                `Secret viewpoint known to locals`,
                `Traditional workshop experience`,
                `Off-the-beaten-path neighborhood`,
                `Local artisan quarter`
            ];
        }

        function getLocalEvents(destination, startDate) {
            const month = startDate.getMonth();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            return `Check local event calendars for ${monthNames[month]} festivals and cultural activities in ${destination}. Many cities have seasonal celebrations, markets, and performances during this time.`;
        }

        // Enhanced AI itinerary display
        function displayEnhancedAIItinerary(itinerary) {
            const container = document.getElementById('itinerary-results');
            let html = `
                <div class="ai-header">
                    <h3>🤖 Your Personalized AI Travel Plan</h3>
                    <div class="destination-overview">
                        <h4>📍 ${itinerary.destination_overview ? 'Destination Insights' : 'Overview'}</h4>
                        ${itinerary.destination_overview ? `
                            <div class="overview-grid">
                                <div class="overview-item">
                                    <strong>🌤️ Climate:</strong> ${itinerary.destination_overview.climate || 'Check local weather'}
                                </div>
                                <div class="overview-item">
                                    <strong>💰 Currency:</strong> ${itinerary.destination_overview.local_currency || 'Local currency'}
                                </div>
                                <div class="overview-item">
                                    <strong>🗣️ Key Phrases:</strong> ${itinerary.destination_overview.language_basics ? itinerary.destination_overview.language_basics.join(', ') : 'Learn basic greetings'}
                                </div>
                                <div class="overview-item">
                                    <strong>💡 Tipping:</strong> ${itinerary.destination_overview.tipping_customs || 'Research local customs'}
                                </div>
                            </div>
                            ${itinerary.destination_overview.best_neighborhoods ? `
                                <div class="neighborhoods">
                                    <strong>🏘️ Best Areas to Explore:</strong>
                                    <ul>${itinerary.destination_overview.best_neighborhoods.map(area => `<li>${area}</li>`).join('')}</ul>
                                </div>
                            ` : ''}
                        ` : ''}
                    </div>
                </div>
            `;

            // Enhanced day-by-day display
            if (itinerary.days) {
                itinerary.days.forEach(day => {
                    html += `
                        <div class="enhanced-day-card">
                            <div class="day-header">
                                <div class="day-title">Day ${day.day} - ${day.date}</div>
                                <div class="day-theme">${day.theme || 'Exploration'}</div>
                            </div>
                            
                            ${day.weather_consideration ? `
                                <div class="weather-note">
                                    <strong>🌤️ Weather:</strong> ${day.weather_consideration}
                                </div>
                            ` : ''}

                            <div class="activities-section">
                                ${day.activities ? day.activities.map(activity => `
                                    <div class="enhanced-activity">
                                        <div class="activity-header">
                                            <span class="activity-time">${activity.time}</span>
                                            <span class="activity-duration">${activity.duration || ''}</span>
                                        </div>
                                        <div class="activity-title">${activity.title}</div>
                                        <div class="activity-location">📍 ${activity.location || ''}</div>
                                        <p class="activity-description">${activity.description}</p>
                                        
                                        ${activity.cost ? `
                                            <div class="activity-cost">
                                                💰 ${activity.cost.amount || activity.cost} ${activity.cost.usd_equivalent ? `(${activity.cost.usd_equivalent})` : ''}
                                            </div>
                                        ` : ''}
                                        
                                        ${activity.insider_tip ? `
                                            <div class="insider-tip">
                                                💡 <strong>Insider Tip:</strong> ${activity.insider_tip}
                                            </div>
                                        ` : ''}
                                        
                                        ${activity.backup_option ? `
                                            <div class="backup-option">
                                                🔄 <strong>Backup:</strong> ${activity.backup_option}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('') : ''}
                            </div>

                            ${day.meals ? `
                                <div class="meals-section">
                                    <h5>🍽️ Today's Dining</h5>
                                    <div class="meals-grid">
                                        ${day.meals.breakfast ? `
                                            <div class="meal-item">
                                                <strong>🌅 Breakfast:</strong> ${day.meals.breakfast.restaurant}<br>
                                                <em>Try: ${day.meals.breakfast.specialty}</em> (${day.meals.breakfast.cost})<br>
                                                <small>${day.meals.breakfast.why_recommended}</small>
                                            </div>
                                        ` : ''}
                                        ${day.meals.lunch ? `
                                            <div class="meal-item">
                                                <strong>☀️ Lunch:</strong> ${day.meals.lunch.restaurant}<br>
                                                <em>Try: ${day.meals.lunch.specialty}</em> (${day.meals.lunch.cost})<br>
                                                <small>${day.meals.lunch.why_recommended}</small>
                                            </div>
                                        ` : ''}
                                        ${day.meals.dinner ? `
                                            <div class="meal-item">
                                                <strong>🌙 Dinner:</strong> ${day.meals.dinner.restaurant}<br>
                                                <em>Try: ${day.meals.dinner.specialty}</em> (${day.meals.dinner.cost})<br>
                                                <small>${day.meals.dinner.why_recommended}</small>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            ` : ''}

                            <div class="day-extras">
                                ${day.cultural_insight ? `
                                    <div class="cultural-insight">
                                        🏛️ <strong>Cultural Insight:</strong> ${day.cultural_insight}
                                    </div>
                                ` : ''}
                                
                                ${day.photo_opportunities ? `
                                    <div class="photo-ops">
                                        📸 <strong>Photo Spots:</strong> ${day.photo_opportunities.join(', ')}
                                    </div>
                                ` : ''}
                                
                                <div class="safety-alert">
                                    <h4>🛡️ Today's Safety Tip</h4>
                                    <p>${day.safety_tip || 'Stay aware of your surroundings and keep valuables secure.'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            // Enhanced practical information
            if (itinerary.practical_information) {
                const practical = itinerary.practical_information;
                html += `
                    <div class="practical-info-section">
                        <h3>📋 Practical Information</h3>
                        
                        ${practical.total_estimated_cost ? `
                            <div class="budget-breakdown">
                                <h4>💰 Budget Breakdown (${practical.total_estimated_cost.total_per_person || 'Per Person'})</h4>
                                ${practical.total_estimated_cost.budget_breakdown ? `
                                    <div class="budget-grid">
                                        ${Object.entries(practical.total_estimated_cost.budget_breakdown).map(([category, amount]) => `
                                            <div class="budget-item">
                                                <span class="budget-category">${category.charAt(0).toUpperCase() + category.slice(1)}:</span>
                                                <span class="budget-amount">${amount}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                ${practical.total_estimated_cost.total_for_group ? `
                                    <div class="total-budget">
                                        <strong>Total for Group: ${practical.total_estimated_cost.total_for_group}</strong>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        ${practical.packing_essentials ? `
                            <div class="packing-section">
                                <h4>🎒 Packing Essentials</h4>
                                <ul class="packing-list">
                                    ${practical.packing_essentials.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}

                        ${practical.cultural_dos_and_donts ? `
                            <div class="culture-section">
                                <h4>🤝 Cultural Guidelines</h4>
                                <div class="dos-donts-grid">
                                    <div class="dos">
                                        <h5>✅ DO:</h5>
                                        <ul>${practical.cultural_dos_and_donts.dos.map(item => `<li>${item}</li>`).join('')}</ul>
                                    </div>
                                    <div class="donts">
                                        <h5>❌ DON'T:</h5>
                                        <ul>${practical.cultural_dos_and_donts.donts.map(item => `<li>${item}</li>`).join('')}</ul>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // Hidden gems and extras
            if (itinerary.hidden_gems || itinerary.local_events) {
                html += `
                    <div class="extras-section">
                        ${itinerary.hidden_gems ? `
                            <div class="hidden-gems">
                                <h4>💎 Hidden Gems</h4>
                                <ul>${itinerary.hidden_gems.map(gem => `<li>${gem}</li>`).join('')}</ul>
                            </div>
                        ` : ''}
                        
                        ${itinerary.local_events ? `
                            <div class="local-events">
                                <h4>🎉 Special Events</h4>
                                <p>${itinerary.local_events}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function displayAIItinerary(itinerary) {
            const container = document.getElementById('itinerary-results');
            let html = `
                <h3>🤖 AI-Generated Personalized Itinerary</h3>
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #ecfdf5 100%); padding: 1rem; border-radius: 10px; margin-bottom: 2rem;">
                    <h4>💰 Total Estimated Cost: ${itinerary.totalEstimatedCost || 'Budget varies'}</h4>
                </div>
            `;
            
            itinerary.days.forEach(day => {
                html += `
                    <div class="day-card">
                        <div class="day-title">Day ${day.day} - ${day.date}</div>
                        ${day.activities.map(activity => `
                            <div class="activity">
                                <div class="activity-time">${activity.time}</div>
                                <div class="activity-title">${activity.title}</div>
                                <p>${activity.description}</p>
                                ${activity.cost ? `<div style="color: #059669; font-weight: 600;">💰 ${activity.cost}</div>` : ''}
                            </div>
                        `).join('')}
                        <div class="safety-alert">
                            <h4>🛡️ Safety Tip for Today</h4>
                            <p>${day.safetyTip}</p>
                        </div>
                    </div>
                `;
            });

            if (itinerary.generalTips && itinerary.generalTips.length > 0) {
                html += `
                    <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 10px; padding: 1rem; margin-top: 2rem;">
                        <h4 style="color: #92400e; margin-bottom: 1rem;">💡 General Travel Tips</h4>
                        <ul style="margin-left: 1rem;">
                            ${itinerary.generalTips.map(tip => `<li style="margin-bottom: 0.5rem;">${tip}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // Update the generate button to use AI
        function generateItinerary() {
            generateItineraryWithAI();
        }

        // Test function to check Gemini API connectivity with CORS fallback
        async function testGeminiAPI() {
            console.log('Testing Gemini API...');
            showStatusMessage('Testing AI connection...', MESSAGE_TYPES.INFO);
            
            try {
                const testPrompt = "Say 'Hello! Gemini API is working correctly!' and nothing else.";
                const requestBody = {
                    contents: [{
                        parts: [{
                            text: testPrompt
                        }]
                    }],
                    generationConfig: {
                        temperature: CONFIG.AI.TEMPERATURE,
                        maxOutputTokens: 100,
                        candidateCount: CONFIG.AI.CANDIDATE_COUNT
                    }
                };

                let response;
                let apiUrl = `${CONFIG.AI.API_URL}?key=${CONFIG.AI.API_KEY}`;

                try {
                    // Try direct API call first
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });
                } catch (corsError) {
                    console.log('Direct API call failed, trying CORS proxy...');
                    showStatusMessage('Retrying with CORS proxy...', MESSAGE_TYPES.INFO);
                    
                    // Try CORS proxy for development
                    if (CONFIG.ENVIRONMENT.isDevelopment) {
                        const proxyUrl = `${CONFIG.AI.PROXY_URL}${encodeURIComponent(apiUrl)}`;
                        response = await fetch(proxyUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestBody)
                        });
                    } else {
                        throw corsError;
                    }
                }

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', errorText);
                    
                    // Provide helpful error messages
                    if (response.status === 403 && errorText.includes('REFERRER_BLOCKED')) {
                        showStatusMessage(`❌ API Error: Referrer blocked. This is a development environment restriction. The API should work in production.`, MESSAGE_TYPES.ERROR);
                    } else {
                        showStatusMessage(`❌ API Error: ${response.status} - ${errorText}`, MESSAGE_TYPES.ERROR);
                    }
                    return;
                }

                const data = await response.json();
                console.log('API Response:', data);

                if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const responseText = data.candidates[0].content.parts[0].text;
                    showStatusMessage(`✅ Gemini AI Connection Successful! Response: ${responseText}`, MESSAGE_TYPES.SUCCESS);
                } else {
                    console.error('Unexpected response format:', data);
                    showStatusMessage('❌ Unexpected response format from AI service', MESSAGE_TYPES.ERROR);
                }
                
            } catch (error) {
                console.error('Test failed:', error);
                let errorMessage = error.message;
                
                if (error.message.includes('fetch')) {
                    errorMessage = 'Network error - please check your internet connection';
                } else if (error.message.includes('API_KEY')) {
                    errorMessage = 'API key configuration error';
                }
                
                showStatusMessage(`❌ AI Connection Test Failed: ${errorMessage}`, MESSAGE_TYPES.ERROR);
            }
        }

        // Comprehensive troubleshooting function
        function runDiagnostics() {
            showStatusMessage('Running system diagnostics...', MESSAGE_TYPES.INFO);
            
            const diagnostics = [];
            
            // Check environment
            const currentHost = window.location.hostname;
            const currentProtocol = window.location.protocol;
            const isDev = CONFIG.ENVIRONMENT.isDevelopment;
            
            diagnostics.push(`🌐 Current host: ${currentHost || 'localhost'}`);
            diagnostics.push(`🔗 Protocol: ${currentProtocol}`);
            
            if (isDev) {
                diagnostics.push('⚠️ Development environment detected');
                diagnostics.push('🔒 API may have referrer restrictions');
                diagnostics.push('🛠️ CORS proxy fallback available');
            } else {
                diagnostics.push('✅ Production environment detected');
                diagnostics.push('🌍 Direct API calls should work');
            }
            
            // Check Google Maps (we use embedded maps, so this is expected to be false)
            if (typeof google !== 'undefined' && google.maps) {
                diagnostics.push('✅ Google Maps API loaded (not needed for our embedded solution)');
            } else {
                diagnostics.push('✅ Using embedded Google Maps (no API required)');
            }
            
            // Check Gemini API key
            if (CONFIG.AI.API_KEY && CONFIG.AI.API_KEY !== 'YOUR_GEMINI_API_KEY_HERE') {
                diagnostics.push('✅ Gemini API key configured');
                
                // Additional API key info for development
                if (isDev) {
                    diagnostics.push('📋 API key may have referrer restrictions in development');
                    diagnostics.push('🔄 Automatic fallback to CORS proxy enabled');
                }
            } else {
                diagnostics.push('❌ Gemini API key not configured');
            }
            
            // Check destination database
            diagnostics.push(`✅ Destination database loaded with ${ALL_DESTINATIONS.length} destinations`);
            
            // Check autocomplete
            const destinationInput = document.getElementById('destination');
            if (destinationInput) {
                diagnostics.push('✅ Destination input field found');
            } else {
                diagnostics.push('❌ Destination input field not found');
            }
            
            // Check form elements
            const form = document.getElementById('itinerary-form');
            if (form) {
                diagnostics.push('✅ Itinerary form found');
            } else {
                diagnostics.push('❌ Itinerary form not found');
            }
            
            // Check configuration
            diagnostics.push(`✅ Configuration loaded with ${Object.keys(CONFIG).length} modules`);
            
            // Development specific recommendations
            if (isDev) {
                diagnostics.push('');
                diagnostics.push('💡 Development Tips:');
                diagnostics.push('• Use "Test AI Connection" to verify API access');
                diagnostics.push('• If you see "referrer blocked" errors, this is normal in development');
                diagnostics.push('• The app will automatically use CORS proxy as fallback');
                diagnostics.push('• All features should work normally in production');
            }
            
            // Display results
            const resultMessage = 'System Diagnostics:\n\n' + diagnostics.join('\n');
            showStatusMessage(resultMessage.replace(/\n/g, '<br>'), MESSAGE_TYPES.INFO);
            console.log('Diagnostics:', diagnostics);
        }

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // Sample data and functions
        const emergencyNumbers = {
            'default': {
                police: '911',
                ambulance: '911',
                fire: '911'
            },
            'united kingdom': {
                police: '999',
                ambulance: '999',
                fire: '999'
            },
            'france': {
                police: '17',
                ambulance: '15',
                fire: '18'
            },
            'japan': {
                police: '110',
                ambulance: '119',
                fire: '119'
            },
            'australia': {
                police: '000',
                ambulance: '000',
                fire: '000'
            }
        };

        const safetyTipsData = {
            general: [
                "Keep copies of important documents in separate locations",
                "Share your itinerary with trusted contacts",
                "Research local customs and laws before traveling",
                "Keep emergency cash in multiple locations",
                "Stay aware of your surroundings at all times",
                "Trust your instincts - if something feels wrong, leave",
                "Keep your phone charged and carry a portable charger",
                "Learn basic phrases in the local language"
            ],
            specific: {
                'night': "Avoid walking alone at night, especially in unfamiliar areas. Use well-lit, populated routes and consider ride-sharing services.",
                'valuables': "Keep valuables hidden and secure. Use hotel safes and avoid displaying expensive items like jewelry or electronics.",
                'transport': "Use licensed transportation services and verify rates beforehand. Keep doors locked in vehicles and be cautious of pickpockets on public transit.",
                'accommodation': "Research accommodation reviews and location safety. Inform reception of your plans and expected return times."
            }
        };

        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        function generateItinerary() {
            const form = document.getElementById('itinerary-form');
            const formData = new FormData(form);
            const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked')).map(cb => cb.value);
            
            // Validate required fields
            const destination = formData.get('destination');
            const startDate = formData.get('start-date');
            const endDate = formData.get('end-date');
            
            if (!destination || !startDate || !endDate) {
                alert('Please fill in all required fields');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('itinerary-results').style.display = 'none';

            // Simulate AI processing
            setTimeout(() => {
                const itinerary = createSampleItinerary(destination, startDate, endDate, interests);
                displayItinerary(itinerary);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('itinerary-results').style.display = 'block';
            }, 3000);
        }

        function createSampleItinerary(destination, startDate, endDate, interests) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            
            const activities = {
                history: ['Visit Historical Museum', 'Guided walking tour of old town', 'Ancient monument exploration'],
                art: ['Art Gallery visit', 'Local artist studio tour', 'Street art walking tour'],
                food: ['Food market tour', 'Cooking class', 'Fine dining experience'],
                nature: ['National park hike', 'Botanical garden visit', 'Scenic viewpoint'],
                nightlife: ['Rooftop bar experience', 'Local music venue', 'Night market exploration'],
                shopping: ['Local market shopping', 'Artisan craft shops', 'Souvenir hunting'],
                adventure: ['Rock climbing', 'Water sports', 'Zip lining adventure'],
                relaxation: ['Spa treatment', 'Beach relaxation', 'Meditation session']
            };

            const itinerary = [];
            for (let i = 0; i < days; i++) {
                const currentDate = new Date(start);
                currentDate.setDate(start.getDate() + i);
                
                const dayActivities = [];
                const selectedInterests = interests.length > 0 ? interests : ['history', 'food', 'nature'];
                
                // Morning activity
                const morningInterest = selectedInterests[Math.floor(Math.random() * selectedInterests.length)];
                dayActivities.push({
                    time: '9:00 AM',
                    title: activities[morningInterest][Math.floor(Math.random() * activities[morningInterest].length)],
                    description: `Start your day with an engaging ${morningInterest} experience in ${destination}.`,
                    type: morningInterest
                });
                
                // Lunch
                dayActivities.push({
                    time: '12:30 PM',
                    title: 'Local Cuisine Lunch',
                    description: `Enjoy authentic ${destination} cuisine at a highly-rated local restaurant.`,
                    type: 'food'
                });
                
                // Afternoon activity
                const afternoonInterest = selectedInterests[Math.floor(Math.random() * selectedInterests.length)];
                dayActivities.push({
                    time: '2:30 PM',
                    title: activities[afternoonInterest][Math.floor(Math.random() * activities[afternoonInterest].length)],
                    description: `Continue exploring with a ${afternoonInterest} adventure.`,
                    type: afternoonInterest
                });
                
                // Evening activity
                if (interests.includes('nightlife')) {
                    dayActivities.push({
                        time: '7:00 PM',
                        title: 'Evening Entertainment',
                        description: `Experience ${destination}'s vibrant nightlife scene.`,
                        type: 'nightlife'
                    });
                }
                
                itinerary.push({
                    day: i + 1,
                    date: currentDate.toLocaleDateString(),
                    activities: dayActivities,
                    safetyNote: generateSafetyNote(destination)
                });
            }
            
            return itinerary;
        }

        function generateSafetyNote(destination) {
            const safetyNotes = [
                "Stay in well-lit areas and avoid displaying valuable items.",
                "Keep emergency contacts readily available and inform someone of your plans.",
                "Be aware of local customs and dress codes to respect the culture.",
                "Stay hydrated and protect yourself from sun exposure.",
                "Use reputable transportation services and verify rates beforehand."
            ];
            return safetyNotes[Math.floor(Math.random() * safetyNotes.length)];
        }

        function displayItinerary(itinerary) {
            const container = document.getElementById('itinerary-results');
            let html = '<h3>Your Personalized Itinerary</h3>';
            
            itinerary.forEach(day => {
                html += `
                    <div class="day-card">
                        <div class="day-title">Day ${day.day} - ${day.date}</div>
                        ${day.activities.map(activity => `
                            <div class="activity">
                                <div class="activity-time">${activity.time}</div>
                                <div class="activity-title">${activity.title}</div>
                                <p>${activity.description}</p>
                            </div>
                        `).join('')}
                        <div class="safety-alert">
                            <h4>🛡️ Safety Tip for Today</h4>
                            <p>${day.safetyNote}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showEmergencyContacts() {
            const destination = document.getElementById('destination').value.toLowerCase() || 'default';
            const contacts = emergencyNumbers[destination] || emergencyNumbers['default'];
            
            const html = `
                <div style="text-align: center;">
                    <h4>🚔 Police: <a href="tel:${contacts.police}" style="color: #ef4444; font-weight: bold;">${contacts.police}</a></h4>
                    <h4>🚑 Ambulance: <a href="tel:${contacts.ambulance}" style="color: #ef4444; font-weight: bold;">${contacts.ambulance}</a></h4>
                    <h4>🚒 Fire Department: <a href="tel:${contacts.fire}" style="color: #ef4444; font-weight: bold;">${contacts.fire}</a></h4>
                    <p style="margin-top: 1rem; color: #6b7280;">Tap any number to call immediately</p>
                </div>
            `;
            
            document.getElementById('emergency-contacts').innerHTML = html;
            document.getElementById('emergency-modal').style.display = 'block';
        }

        function shareLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const locationUrl = `https://maps.google.com/?q=${lat},${lng}`;
                    
                    // Create shareable message
                    const message = `I'm currently at: ${locationUrl}\n\nSent from go.travel - Stay safe!`;
                    
                    if (navigator.share) {
                        navigator.share({
                            title: 'My Current Location',
                            text: message,
                            url: locationUrl
                        });
                    } else {
                        // Fallback: copy to clipboard
                        navigator.clipboard.writeText(message).then(() => {
                            alert('Location copied to clipboard! Share this with your trusted contacts.');
                        });
                    }
                }, function(error) {
                    alert('Unable to get your location. Please check your browser permissions.');
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }

        function checkSafetyAlerts() {
            const destination = document.getElementById('destination').value || 'your destination';
            
            // Simulate safety alerts
            const alerts = [
                {
                    level: 'info',
                    title: 'Weather Advisory',
                    message: `Light rain expected in ${destination} this evening. Carry an umbrella.`
                },
                {
                    level: 'warning',
                    title: 'Area Advisory',
                    message: `Increased pickpocket activity reported near tourist areas. Stay vigilant.`
                },
                {
                    level: 'info',
                    title: 'Transportation Update',
                    message: `Public transit running normally with minor delays during rush hour.`
                }
            ];
            
            let alertHtml = '<div style="max-height: 300px; overflow-y: auto;">';
            alerts.forEach(alert => {
                const color = alert.level === 'warning' ? '#fbbf24' : '#3b82f6';
                alertHtml += `
                    <div style="border-left: 4px solid ${color}; padding: 1rem; margin-bottom: 1rem; background: #f8fafc;">
                        <h4 style="color: ${alert.level === 'warning' ? '#92400e' : '#1e40af'}; margin-bottom: 0.5rem;">${alert.title}</h4>
                        <p>${alert.message}</p>
                    </div>
                `;
            });
            alertHtml += '</div>';
            
            // Create and show alert modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                    <h3>Current Safety Alerts</h3>
                    ${alertHtml}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showSafetyTips() {
            const destination = document.getElementById('destination').value || 'your destination';
            
            let tipsHtml = `<div style="max-height: 400px; overflow-y: auto;">
                <h4>General Safety Tips for ${destination}:</h4>
                <ul style="padding-left: 1.5rem; margin-bottom: 2rem;">`;
            
            safetyTipsData.general.forEach(tip => {
                tipsHtml += `<li style="margin-bottom: 0.5rem;">${tip}</li>`;
            });
            
            tipsHtml += `</ul><h4>Specific Safety Advice:</h4>`;
            
            Object.entries(safetyTipsData.specific).forEach(([category, tip]) => {
                tipsHtml += `
                    <div style="border-left: 4px solid #059669; padding: 1rem; margin-bottom: 1rem; background: #f0fdf4;">
                        <h5 style="color: #059669; margin-bottom: 0.5rem; text-transform: capitalize;">${category} Safety</h5>
                        <p>${tip}</p>
                    </div>
                `;
            });
            
            tipsHtml += '</div>';
            
            document.getElementById('safety-tips').innerHTML = tipsHtml;
            document.getElementById('safety-modal').style.display = 'block';
        }

        function triggerEmergency() {
            const confirmEmergency = confirm('Are you experiencing a real emergency? This will attempt to contact emergency services.');
            
            if (confirmEmergency) {
                // Show emergency options
                const emergencyHtml = `
                    <div style="text-align: center;">
                        <h3 style="color: #ef4444; margin-bottom: 2rem;">🚨 Emergency Response Activated</h3>
                        
                        <div style="margin-bottom: 2rem;">
                            <button onclick="window.open('tel:911')" style="background: #ef4444; color: white; padding: 1rem 2rem; border: none; border-radius: 10px; font-size: 1.2rem; margin: 0.5rem; cursor: pointer; width: 200px;">
                                📞 Call Emergency Services
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <button onclick="sendEmergencyLocation()" style="background: #f59e0b; color: white; padding: 1rem 2rem; border: none; border-radius: 10px; font-size: 1rem; margin: 0.5rem; cursor: pointer; width: 200px;">
                                📍 Share Emergency Location
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <button onclick="showNearbyHospitals()" style="background: #059669; color: white; padding: 1rem 2rem; border: none; border-radius: 10px; font-size: 1rem; margin: 0.5rem; cursor: pointer; width: 200px;">
                                🏥 Find Nearby Hospitals
                            </button>
                        </div>
                        
                        <p style="color: #6b7280; font-size: 0.9rem;">
                            If this is not a real emergency, please close this dialog.
                        </p>
                    </div>
                `;
                
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                        ${emergencyHtml}
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function sendEmergencyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const emergencyMessage = `🚨 EMERGENCY ALERT 🚨\n\nI need immediate assistance at:\nhttps://maps.google.com/?q=${lat},${lng}\n\nTime: ${new Date().toLocaleString()}\n\nSent from go.travel Emergency System`;
                    
                    if (navigator.share) {
                        navigator.share({
                            title: '🚨 EMERGENCY ALERT',
                            text: emergencyMessage
                        });
                    } else {
                        navigator.clipboard.writeText(emergencyMessage).then(() => {
                            alert('Emergency location copied to clipboard! Send this to your emergency contacts immediately.');
                        });
                    }
                });
            } else {
                alert('Location services not available. Please manually share your location with emergency services.');
            }
        }

        function showNearbyHospitals() {
            // Simulate nearby hospitals data
            const hospitals = [
                { name: 'City General Hospital', distance: '0.8 miles', phone: '(555) 123-4567' },
                { name: 'Emergency Medical Center', distance: '1.2 miles', phone: '(555) 234-5678' },
                { name: 'Regional Healthcare', distance: '2.1 miles', phone: '(555) 345-6789' }
            ];
            
            let hospitalHtml = '<div style="text-align: left;"><h4>Nearest Medical Facilities:</h4>';
            hospitals.forEach(hospital => {
                hospitalHtml += `
                    <div style="border: 1px solid #e5e7eb; border-radius: 10px; padding: 1rem; margin-bottom: 1rem;">
                        <h5 style="margin-bottom: 0.5rem;">${hospital.name}</h5>
                        <p style="color: #6b7280; margin-bottom: 0.5rem;">Distance: ${hospital.distance}</p>
                        <button onclick="window.open('tel:${hospital.phone}')" style="background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 5px; cursor: pointer;">
                            Call ${hospital.phone}
                        </button>
                    </div>
                `;
            });
            hospitalHtml += '</div>';
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
                    <h3>🏥 Nearby Medical Facilities</h3>
                    ${hospitalHtml}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('start-date').setAttribute('min', today);
            document.getElementById('end-date').setAttribute('min', today);

            // Update end date minimum when start date changes
            document.getElementById('start-date').addEventListener('change', function(e) {
                document.getElementById('end-date').setAttribute('min', e.target.value);
            });

            // Auto-update emergency numbers based on destination
            document.getElementById('destination').addEventListener('input', function(e) {
                const destination = e.target.value.toLowerCase();
                if (emergencyNumbers[destination]) {
                    console.log(`Emergency numbers updated for ${destination}`);
                }
            });
            
            // Add smooth scrolling for navigation
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Handle browser back button
        window.addEventListener('popstate', function() {
            // Close any open modals
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        });

        // Initialize the page when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing page...');
            
            // Set default dates
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const weekLater = new Date(today);
            weekLater.setDate(weekLater.getDate() + 7);
            
            document.getElementById('start-date').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('end-date').value = weekLater.toISOString().split('T')[0];
            
            // Initialize basic autocomplete if Google Maps isn't ready
            setTimeout(function() {
                if (typeof google === 'undefined' || !google.maps) {
                    console.log('Google Maps not available, using basic autocomplete');
                    setupBasicAutocomplete();
                    showMapFallback();
                }
            }, 3000);
            
            console.log('Page initialization complete');
        });

        // Make sure initMap is available globally
        window.initMap = initMap;
    </script>
</body>
</html>